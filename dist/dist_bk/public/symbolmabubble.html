<!DOCTYPE html>
<html>

<head>
    <title>SMA Bubble</title>
    <script src="https://github.com/tam888888/stockData/releases/download/1.0.0/symbols.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/keytable/2.11.0/js/dataTables.keyTable.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.colVis.min.js"></script>
    <script src="https://cdn.datatables.net/fixedcolumns/4.3.0/js/dataTables.fixedColumns.min.js"></script>
    <script src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>

    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/fixedcolumns/4.3.0/css/fixedColumns.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/scroller/2.3.0/css/scroller.dataTables.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/keytable/2.11.0/css/keyTable.dataTables.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">


    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"
        integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+"
        crossorigin="anonymous"></script>

    <script src="https://github.com/tam888888/stockData/releases/download/1.0.0/chart.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://github.com/tam888888/stockData/releases/download/1.0.0/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>

    <link rel="stylesheet" type="text/css" href="tooltipster.bundle.min.css">
    <script type="text/javascript" charset="utf8"
        src="https://github.com/tam888888/stockData/releases/download/1.0.0/tooltipster.bundle.min.js"></script>

    <style>
        div.dataTables_wrapper div.dataTables_info {
            padding-top: 0px;
        }

        div.dataTables_wrapper div.dataTables_info {
            font-size: 6px;
            /* Set font size for information text (e.g., "Showing 1 to 10 of 100 entries") */
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        table,
        th,
        td {
            border: 1px solid #ccc;
        }

        th,
        td {
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
    <style>
        /* CSS for limiting the number of rows and adding a vertical scroll */
        #timelineContainer {
            max-height: 600px;
            /* Set the maximum height for the table */
            overflow-y: auto;
            /* Enable vertical scrolling */
        }
    </style>
    <style>
        /* CSS for enabling both horizontal and vertical scrolling for the entire page */
        body,
        html {
            overflow: scroll;
            /* Enable both horizontal and vertical scrolling for the entire page */
        }
    </style>
    <style>
        /* #chartcontainer {
            text-align: center;
        }

        #vnindex,#busd {
            display: inline;
        } */
        #chartcontainer {
            display: flex;
            justify-content: center;
        }

        #combineDiv {
            display: flex;
            /* flex-wrap: wrap; */
            /* Cho phép các ô chuyển hàng khi không đủ không gian */
            /* justify-content: center; */
        }

        .hidden-element {
            display: none;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 700px);
            /* 3 cột trong mỗi hàng */
            grid-gap: 10px;
            /* Khoảng cách giữa các ô */
            /* grid-auto-rows: 300px; */
        }

        .grid-item {
            /* Định dạng cho mỗi ô trong grid */
            border: 1px solid #ddd;
            padding: 10px;
            width: 700px;
            /* Chiều rộng của mỗi ô */
            height: 700px;
            /* Chiều cao của mỗi ô */
        }

        .flex-container {
            display: flex;
            flex-wrap: wrap;
            /* Cho phép các ô chuyển hàng khi không đủ không gian */
            justify-content: center;
        }

        .flex-item3 {
            flex: 0 0 calc(33.33% - 20px);
            /* 33.33% chiều rộng mỗi ô, trừ đi khoảng cách giữa các ô */
            box-sizing: border-box;
            /* Đảm bảo padding và border không làm tăng kích thước thực tế của ô */
            margin: 10px;
            /* Khoảng cách giữa các ô */
        }

        .flex-item2 {
            flex: 0 0 calc(50% - 20px);
            /* 33.33% chiều rộng mỗi ô, trừ đi khoảng cách giữa các ô */
            box-sizing: border-box;
            /* Đảm bảo padding và border không làm tăng kích thước thực tế của ô */
            margin: 10px;
            /* Khoảng cách giữa các ô */
        }

        .flex-item1 {
            flex: 0 0 calc(90% - 20px);
            /* 33.33% chiều rộng mỗi ô, trừ đi khoảng cách giữa các ô */
            box-sizing: border-box;
            /* Đảm bảo padding và border không làm tăng kích thước thực tế của ô */
            margin: 10px;
            /* Khoảng cách giữa các ô */
        }

        .flex-itemOne {
            flex: 0 0 calc(80% - 20px);
            /* 33.33% chiều rộng mỗi ô, trừ đi khoảng cách giữa các ô */
            box-sizing: border-box;
            /* Đảm bảo padding và border không làm tăng kích thước thực tế của ô */
            margin: 10px;
            /* Khoảng cách giữa các ô */
        }

        .custom-link {
            text-decoration: none !important;
        }

        /* .tooltip {
            position: absolute;
            z-index: 1;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
            display: none;
        } */

        .tooltipContainer {
            overflow: hidden;
            position: relative;
            display: inline-block;
            border: 2px solid #007bff;
            /* Đường viền màu xanh */
            border-radius: 10px;
            /* Bo tròn */
            padding: 0px;
            background-color: FloralWhite;
        }

        .tooltipHeader {
            position: relative;
            display: inline-block;
            border: 2px solid #007bff;
            /* Đường viền màu xanh */
            border-radius: 10px;
            /* Bo tròn */
            padding: 10px;
        }

        .custom-theme {
            background-color: #8a2be2;
            /* Purple background color */
            color: #fff;
            /* White text color */
            border-radius: 5px;
            /* Rounded corners */
        }

        .my-custom-theme {
            border-radius: none;
            border: none;
            background: rgba(0, 0, 0, 0);
            color: #000;
            border-color: rgba(0, 0, 0, 0);
        }

        /* Use this next selector to style things like font-size and line-height: */
        .my-custom-theme .tooltipster-content {
            font-family: Arial, sans-serif;
            font-size: 14px;
            line-height: 16px;
            padding: 8px 10px;
            background: lightyellow;
            color: #111010;
            border-radius: none;
            border: none;
        }

        .scrollable-div {
            width: 100%;
            /* Set the width as needed */
            height: 700px;
            /* Set the height as needed */
            overflow: auto;
            /* Enable scrolling */
            border: 1px solid #ccc;
            /* Optional: Add a border for better visibility */
        }


        .container {
            position: relative;
            height: 100vh;
            /* Chiều cao của màn hình */
        }

        .button-container {
            position: fixed;
            bottom: 10px;
            /* Khoảng cách từ bottom là 10px */
            right: 10px;
            /* Khoảng cách từ right là 10px */
        }

        .button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }

        .button:hover,
        .button.key-pressed {
            background-color: #ce1f76;
        }

        .underlined-red {
            text-decoration: underline;
            /* color: red; */
        }

        #stackedsectorsChart {
            width: 2000px;
            /* height: 1500px; */
            margin: auto;
            display: block;
        }
    </style>
</head>

<body>
    <br />
    <br />
    <br />
    <div id="combineDiv" class="flex-container">
    </div>
    <!-- <div class="tooltip" id="tooltipContainer"></div> -->
    <div class="container">
        <div class="button-container">
            <!-- <div id="statusZoom">Status</div> -->
        </div>
        <div class="button-container">
            <div id="statusZoom" style="text-align: center;">Status</div>
            <!-- <button class="button" onclick="vnindex()">VNINDEX</button> -->
            <input type="text" class="button" id="code_filter" value="Searchs symbol">
            <input type="date" class="button" id="queryDateInput">
            <button style="display: none;" class="button" onclick="vnindex()"><span
                    class="underlined-red">V</span>NINDEX</button>

            <button class="button" onclick="resetChart()"><span class="underlined-red">R</span>eset Zoom</button>
            <button class="button" onclick="togglePan()">Toggle <span class="underlined-red">P</span>an</button>
            <button class="button" onclick="toggleZoom()">Toggle <span class="underlined-red">Z</span>oom</button>
            <button style="display: none;" class="button" id="chartTypeBtn" onclick="changeChart()">(<span
                    class="underlined-red">C</span>)
                Chart</button>
        </div>
    </div>
    <script>
        var short_day = [5, 9, 10, 12, 20, 25, 26, 30, 50, 100, 200]
        var bb = ['upper', 'middle', 'lower']
        function getNowDate() {
            let fd = new Date();
            return fd.getFullYear()
                + "" + (fd.getMonth() + 1 < 10 ? "0" + (fd.getMonth() + 1) : fd.getMonth() + 1)
                + "" + (fd.getDate() < 10 ? "0" + fd.getDate() : fd.getDate());
        }

        let vf = (v) => {
            if (v) return v;
            return 0
        }
        const url = new URL(window.location.href);
        const queryParams = url.searchParams;
        var interval = queryParams.get('interval');
        if (!interval) interval = 5
        var sortby = queryParams.get('sortby');
        if (!sortby) {
            sortby = 'pct'
        }
        var valMin = queryParams.get('valMin');
        if (!valMin) {
            valMin = 10000000000;
        } else {
            valMin = +valMin
        }
        var volMin = queryParams.get('volMin');
        if (!volMin) {
            volMin = 200000;
        } else {
            volMin = +volMin
        }

        var chartType = queryParams.get('chart');
        if (!chartType) {
            chartType = 'bubble';
        }


        var querydate = queryParams.get('querydate');
        if (!querydate) querydate = getNowDate()

        var maxr = queryParams.get('maxr');
        if (maxr) { maxr = +maxr }
        var minr = queryParams.get('minr');
        if (minr) { minr = +minr }

        var maxpct = queryParams.get('maxpct');
        if (maxpct) { maxpct = +maxpct }
        var minpct = queryParams.get('minpct');
        if (minpct) { minpct = +minpct }

        var minrtext = queryParams.get('minrtext');
        if (minrtext) { minrtext = +minrtext }

        var displaylabel = queryParams.get('displaylabel');
        if (displaylabel) { displaylabel = +displaylabel } else {
            displaylabel = 100;
        }

        var valminlabel = queryParams.get('valminlabel');
        if (!valminlabel) {
            valminlabel = 5e10;
        } else {
            valminlabel = +valminlabel
        }

        var pctlabel = queryParams.get('pctlabel');
        if (!pctlabel) {
            pctlabel = 2;
        } else {
            pctlabel = +pctlabel
        }

        var sectorcolor = queryParams.get('sectorcolor');
        var ebusd = queryParams.get('busd');

        if (chartType.toLowerCase() != 'bar') {
            chartTypeBtn.innerHTML = '(<span class="underlined-red">C</span>) Bar';
        }

        // statsHead = document.getElementById('footTable');
        // statsHead.innerHTML = ''
        // var theadRow = document.createElement('tr');
        // statsHead.appendChild(theadRow);

        var percent = queryParams.get('percent');
        let combineDivContainer = document.getElementById('combineDiv')
        var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        let flex = "flex-item2"
        if (width < 1024) {
            flex = "flex-item1"
        } else if (width > 1024 && width <= 1920) {
            flex = "flex-item2"
        } else {
            flex = "flex-item3"
        }
        flex = "flex-item1"
        if (combineDivContainer) {
            let innerHTML = '';
            [...short_day, ...bb].forEach(e => {
                innerHTML += '<div class="' + flex + '"><canvas id="' + 'MA' + e + '" style="width: 100%; margin: 0 auto;"></canvas></div>'
            })

            // innerHTML += '<div class="' + flex + '"><canvas id="' + 'stackedsectorsVal' + 'Chart" style="width: 100%; margin: 0 auto;"></canvas></div>'
            combineDivContainer.innerHTML = innerHTML;
        }


        var topVal = ["HPG", "SSI", "VND", "STB", "DIG", "VHM", "VIX", "GEX", "MWG", "EIB", "SHS", "TCB", "VPB", "SHB", "DXG", "MBB", "NVL", "PDR", "HAG", "FPT", "MSN", "CEO", "DBC", "HSG", "HCM", "ACB", "VCI", "KBC", "NKG", "HDB", "DGC", "VCG", "VNM", "CTG", "TPB", "CII", "PVS", "HUT", "VCB", "IDC", "VIC", "PNJ", "VJC", "EVF", "MSB", "TCH", "HHV", "PVD", "HAH", "PVT", "CTD", "KDC", "VRE", "MBS", "BSR", "VIB", "DGW", "DCM", "GMD", "VPI", "VSC", "HDC", "NLG", "OCB", "VHC", "BAF", "LPB", "BCG", "SZC", "BID", "FTS", "DPM", "GAS", "KDH", "HDG", "POW", "HQC", "LCG", "PC1", "ITA", "SSB", "SAB", "VTP", "BCM", "PET", "FRT", "GVR", "VGC", "ANV", "REE", "CTS", "KSB", "ASM", "SBT", "TNG", "HNG", "GKM", "ORS", "TIG", "CTR", "CTF", "TCM", "BSI", "DTD", "PLX", "IDI", "KOS", "FCN", "AGR", "QNS", "DPG", "NAB", "NTL", "IJC", "HVN", "KHG", "ST8", "PAN", "AGG", "HHS", "FIR", "NT2", "AAA", "VPG", "SCR", "DXS", "PVC", "VGI", "NHH", "VGS", "VOS", "CSV", "C4G", "APG", "SAM", "VC3", "HTN", "CDC", "LDG", "BVH", "VEA", "L14", "POM", "LAS", "TCI", "EVS", "PSH", "VFS", "EVG", "TTF", "GIL", "TCD", "ABB", "TV2", "AAS", "SBS", "VDS", "ELC", "MST", "QCG", "OGC", "DGT", "DHC", "IDJ", "CRE", "BFC", "RDP", "VC7", "HTP", "FIT", "TIP", "TLH", "DRH", "HBC", "DLG", "OIL", "TNH", "ADS", "LSS", "CTI", "CMX", "HSV", "VNE", "TTA", "SKG", "LTG", "MBG", "GEG", "DVM", "HAX", "ITC", "DDV", "ABS", "HCD", "DXP", "DDG", "IPA", "DSC", "AMV", "VGT", "VHG", "HAR", "TLD", "HT1", "NRC", "DC4", "LIG", "TSC", "MHC", "APS", "APH", "ABW", "CEN", "SMC", "TDP", "KPF", "TDC", "BIG", "DAH", "VIG", "BOT", "HHP", "C69", "VC2", "DL1", "NO1", "API", "HAP", "AAT", "TTH", "TVN", "TNT", "PXL", "CCL", "JVC", "VHE", "SRA", "QBS", "CTP", "HHG", "DVG", "LCM", "CVN", "DST"];
        topVal = topVal.slice(0, displaylabel)
        mapSymbolLabel = {};
        topVal.forEach(s => { mapSymbolLabel[s] = true })
        var zoomCb;
        var resetZoomCb;
        const zoomOptions = {
            pan: {
                enabled: true,
                mode: 'xy',
                // scaleMode: 'y',
                modifierKey: 'ctrl',

                onPan: function () {
                    console.log("PAN");
                }

            },
            zoom: {
                mode: 'xy',
                wheel: {
                    enabled: true,
                },
                pinch: {
                    enabled: true
                },
                drag: {
                    enabled: true,
                    borderColor: 'rgb(54, 162, 235)',
                    borderWidth: 1,
                    backgroundColor: 'rgba(54, 162, 235, 0.3)'
                },
                onZoomComplete({ chart }) {
                    chart.update('none');
                },
                // scaleMode: 'y',
                onZoom: function (ctx) {

                    console.log("zoom", ctx);
                    if (zoomCb) zoomCb(ctx.chart)

                }
            }
        };
        let labelValue;
        let labelValue2;

        function getRandomColor() {
            var letters = '0123456789ABCDEF';
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function createChart(symbol, name, key, plugins) {
            //combineChart
            const ctxCombineChart = document.getElementById(symbol).getContext('2d');
            var lineTension = 0.2
            const combineData = {
                labels: ['A', 'B', 'C'],
                datasets: [
                    {
                        label: name,
                        lineTension: lineTension,
                        xAxisID: 'xlabels',
                        yAxisID: 'y-axis-vnindex',
                        data: [
                            { x: 5, y: 100000, r: 10, symbol: 'AAPL' },
                            { x: -3, y: 150000, r: 15, symbol: 'GOOGL' },
                            { x: 8, y: 80000, r: 8, symbol: 'MSFT' },
                            // Add more data points as needed
                        ],
                        // borderColor: 'Magenta',
                        // backgroundColor: 'Magenta',
                        pointRadius: 2, // Kích thước đánh dấu
                        pointHoverRadius: 6, // Kích thước đánh dấu khi di chuột qua   
                        borderWidth: 2, // Kích thước của đường                        

                    },

                ],
            };
            const footer = (a) => {
                console.log(a)
            }
            const combineConfig = {
                type: chartType, // Đây là loại biểu đồ đường (line chart)
                data: combineData,
                plugins: plugins,
                options: {
                    title: {
                        display: true,
                        text: name,
                    },
                    indexAxis: 'y',
                    maintainAspectRatio: false, // Cho phép tùy chỉnh chiều rộng và chiều cao
                    responsive: true, // Đảm bảo tính phản hồi
                    scales: {

                        'xlabels': {
                            position: 'top',
                            title: {
                                display: true,
                                text: name,
                                font: {
                                    size: 24,          // Kích thước phông chữ
                                    weight: 'bold',  // In đậm                                
                                }
                            },
                            suggestedMin: -1,  // Bắt đầu từ 999
                            ticks: {
                                stepSize: 0.25,
                                callback: function (value, index, values) {
                                    return value;
                                }
                            }
                        },
                        'y-axis-vnindex': {
                            // position: 'right',
                            title: {
                                display: true,
                                text: "Độ lệch đường MA" + "(%)",
                                font: {
                                    size: 24,          // Kích thước phông chữ
                                    weight: 'bold',  // In đậm                                
                                }
                            },
                            beginAtZero: false,
                            suggestedMin: 0,  // Bắt đầu từ 999
                            ticks: {
                                stepSize: 0.25,
                                callback: function (value, index, values) {
                                    return value
                                    // return numeral(+value / 1000000).format('0,0.00')
                                }
                            }
                        },

                    },
                    plugins: {

                        zoom: zoomOptions,
                        datalabels: {
                            align: symbol === 'stackedsectorsVal' ? 'end' : 'top',
                            anchor: symbol === 'stackedsectorsVal' ? 'end' : 'center',
                            // offset: 4,
                            color: symbol === 'stackedsectorsVal' ? 'blue' : 'black',
                            font: {
                                size: 8 // Set the font size for the text labels
                            },
                            formatter: function (value, context) {
                                if (mapSymbolLabel[value.symbol] || Math.abs(value.x) >= pctlabel || Math.abs(value.y) >= valminlabel) {
                                    return ebusd ? value.symbol + '\n' + numeral(value.busd / 1e9).format('0,0.0') : value.symbol
                                }
                                if (minrtext && value.r < minrtext) {
                                    return ''
                                } else {
                                    return ebusd ? value.symbol + '\n' + numeral(value.busd / 1e9).format('0,0.0') : value.symbol
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {

                                },
                                footer: (ctx) => {
                                    var pad = 15
                                    var str = 'Info: \n' + 'busd: '.padEnd(pad) + numeral(ctx[0].raw.busd).format('0,0')
                                        + ' \npct: '.padEnd(pad) + ctx[0].raw.pct
                                        + ' \nprice: '.padEnd(pad) + ctx[0].raw.price
                                        + ' \nopen: '.padEnd(pad) + ctx[0].raw.open
                                        + ' \nclose: '.padEnd(pad) + ctx[0].raw.close
                                        + ' \nhigh: '.padEnd(pad) + ctx[0].raw.high
                                        + ' \nlow: '.padEnd(pad) + ctx[0].raw.low
                                        + ' \nref: '.padEnd(pad) + ctx[0].raw.priceref
                                        + ' \nceiling: '.padEnd(pad) + ctx[0].raw.ceiling
                                        + ' \nfloor: '.padEnd(pad) + ctx[0].raw.floor
                                        + ' \nchange '.padEnd(pad) + ctx[0].raw.change

                                    if (+key >= 0) {
                                        str = str + ' \nprice_ma_' + key + ': '.padEnd(pad) + ctx[0].raw[key]['price_ma_' + key]
                                            + ' \nprice_ma_p_' + key + ': '.padEnd(pad) + ctx[0].raw[key]['price_ma_p_' + key]
                                            + ' \npct_ma_' + key + ': '.padEnd(pad) + ctx[0].raw[key]['pct_ma_' + key]
                                    }
                                    else {
                                        str = str 
                                            + ' \nprice_bb_p_' + key + ': '.padEnd(pad) + ctx[0].raw[key]['price_bb_p_' + key]
                                            + ' \npct_bb_' + key + ': '.padEnd(pad) + ctx[0].raw[key]['pct_bb_' + key]
                                    }

                                    return str;
                                },
                            }
                        },
                        afterDraw: function (chart) {
                            var ctx = chart.ctx;
                            var xAxis = chart.scales.x;
                            var yAxis = chart.scales.y;

                            console.log('--------------------------------------------------------------')

                            ctx.save();
                            ctx.beginPath();
                            ctx.moveTo(xAxis.left, yAxis.getPixelForValue(0));
                            ctx.lineTo(xAxis.right, yAxis.getPixelForValue(0));
                            ctx.strokeStyle = 'red';
                            ctx.lineWidth = 2;
                            ctx.stroke();
                            ctx.restore();
                        },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    yMin: 0,
                                    yMax: 0,
                                    borderColor: 'rgb(255, 99, 132)',
                                    borderWidth: 2,
                                    label: {
                                        content: '0(%)',
                                        display: true, // 
                                        position: 'start',
                                        backgroundColor: "rgba(255, 26, 104, 0.8)",
                                        color: "black",
                                    }
                                },
                                line2: {
                                    type: 'line',
                                    yMin: 5,
                                    yMax: 5,
                                    borderColor: 'rgb(255, 99, 132)',
                                    borderWidth: 2,
                                    label: {
                                        content: '5(%)',
                                        display: true, // 
                                        position: 'start',
                                        backgroundColor: "rgba(255, 26, 104, 0.8)",
                                        color: "black",
                                    }
                                },
                                line3: {
                                    type: 'line',
                                    yMin: 10,
                                    yMax: 10,
                                    borderColor: 'rgb(255, 99, 132)',
                                    borderWidth: 2,
                                    label: {
                                        content: '10(%)',
                                        display: true, // 
                                        position: 'start',
                                        backgroundColor: "rgba(255, 26, 104, 0.8)",
                                        color: "black",
                                    }
                                },
                                line4: {
                                    type: 'line',
                                    yMin: 15,
                                    yMax: 15,
                                    borderColor: 'rgb(255, 99, 132)',
                                    borderWidth: 2,
                                    label: {
                                        content: '15(%)',
                                        display: true, // 
                                        position: 'start',
                                        backgroundColor: "rgba(255, 26, 104, 0.8)",
                                        color: "black",
                                    }
                                },
                                vnindex: {
                                    type: 'line',
                                    yMin: 0,
                                    yMax: 0,
                                    borderColor: 'magenta',
                                    borderWidth: 2,
                                    label: {
                                        content: 'VNINDEX',
                                        display: true, // 
                                        position: 'start',
                                        backgroundColor: "rgba(255, 26, 104, 0.8)",
                                        color: "black",
                                    }
                                }
                            }
                        }

                    },

                },

            };
            var combineChart = new Chart(ctxCombineChart, combineConfig);
            return combineChart;
        }

        // var combineChart = createChart('MA100', 'Các mã nổi', [ChartDataLabels]);
        var maChart = [...short_day.map(e => createChart('MA' + e, 'Đường SMA ' + e, e, [ChartDataLabels])),
        ...bb.map(e => createChart('MA' + e, 'Đường Bollinger Bands  ' + e, e, [ChartDataLabels])),]

        let fields = ["sector", "time", "all", "allBig"
            , "tran", "tang", "thamchieu", "giam", "san",
        ]
        const falllabels = function (value, context) {
            return ebusd ? value.symbol + '\n' + numeral(value.busd / 1e9).format('0,0.0') : value.symbol
            // if (minrtext && value.r < minrtext) {
            //     return value.symbol + '\n' + numeral(value.busd / 1e9).format('0,0.0')
            // } else {
            //     return value.symbol + '\n' + numeral(value.busd / 1e9).format('0,0.0')
            // }
        }
        const flargerlabels = function (value, context) {
            if (mapSymbolLabel[value.symbol] || Math.abs(value.x) >= pctlabel || Math.abs(value.y) >= valminlabel) {
                return ebusd ? value.symbol + '\n' + numeral(value.busd / 1e9).format('0,0.0') : value.symbol
            }
            if (minrtext && value.r < minrtext) {
                return ''
            } else {
                return ebusd ? value.symbol + '\n' + numeral(value.busd / 1e9).format('0,0.0') : value.symbol
            }
        }
        var lastZoomScaleX = null;
        var lastZoomScaleY = null;
        var lastZoom = {}
        zoomCb = (combineChart) => {
            var name = combineChart.config.options.title.text;
            if (lastZoom[name]) {
                lastZoomScaleX = lastZoom[name].lastZoomScaleX
                lastZoomScaleY = lastZoom[name].lastZoomScaleY
            } else {
                lastZoom[name] = { lastZoomScaleX: null, lastZoomScaleY: null }
            }


            var currentScaleX = combineChart.options.scales.xlabels.min; // Hoặc lấy giá trị của trục y tùy thuộc vào biểu đồ của bạn

            console.log(currentScaleX, combineChart.options.scales.xlabels.min, lastZoomScaleX)
            if (lastZoomScaleX === null || currentScaleX > lastZoomScaleX) {
                console.log('Zoom In X');
                combineChart.config.options.plugins.datalabels.formatter = falllabels;
                return;
            } else if (currentScaleX < lastZoomScaleX) {
                console.log('Zoom Out X');
                combineChart.config.options.plugins.datalabels.formatter = flargerlabels;
            }
            lastZoom[name].lastZoomScaleX = currentScaleX;
            var currentScaleY = combineChart.options.scales['y-axis-vnindex'].min;
            if (lastZoomScaleY === null || currentScaleY > lastZoomScaleY) {
                console.log('Zoom In Y');
                combineChart.config.options.plugins.datalabels.formatter = falllabels
                return;
            } else if (currentScaleY < lastZoomScaleY) {
                console.log('Zoom Out Y');
                combineChart.config.options.plugins.datalabels.formatter = flargerlabels
            }
            lastZoom[name].lastZoomScaleY = currentScaleY;

        }
        resetZoomCb = () => {
            maChart.forEach(chart => {
                chart.config.options.plugins.datalabels.formatter = flargerlabels;
            })
        }

        var colorsX = [
            "Red", "Orange", "Yellow", "Green", "Blue", "Indigo", "Violet",
            "Pink", "Coral", "Teal", "Cyan", "Lavender", "Maroon", "Olive",
            "Navy", "Mint", "Gold", "Silver", "GreenYellow", "Magenta", "Plum", "Slate",
            "Brick", "Sage", "Azure", "Ruby"
        ];
        console.log(colorsX);

        var sectorCodeList2;
        var mapSectorCode = {};
        var mapColorSymbolSector = {}
        var mapPosSymbolSector = {}
        var order2 = ["8300", "8600", "8700", "2700", "1700", "2300", "3500", "1300", "5300", "0500", "9500", "7500", "3700", "3300", "5700", "6500", "4500", "8500", "5500"]
        var step = 100 / order2.length;

        function generateRandomNumber(inputString, max) {
            // Lấy 3 ký tự đầu tiên của chuỗi
            const firstThreeChars = inputString.slice(0, 3);

            // Chuyển đổi 3 ký tự đầu tiên thành giá trị số
            const numericalValue = parseInt(firstThreeChars, 36);

            // Lấy phần dư khi chia cho 100 và cộng thêm 1
            const randomValue = (numericalValue % max) + 1;

            return randomValue;
        }

        $.ajax({
            url: `/api/getsectorcodelist`,
            method: 'GET',
            success: function (response) {
                sectorCodeList2 = response;
                console.log(sectorCodeList2)
                order2.map(e => {
                    return sectorCodeList2.filter(sc => sc.industryCode == e)[0]
                }).forEach((e, i) => {
                    mapSectorCode[e.industryCode] = e.vietnameseName;
                    var sectorPos = i * step;

                    e.codeList.forEach(s => {
                        mapColorSymbolSector[s] = colorsX[i]
                        mapPosSymbolSector[s] = sectorPos + generateRandomNumber(s, Math.round(step) * 10000) / 10000
                    })
                })
            },
            error: function (error) {
                console.error('Error fetching updated data:', error);
            }
        });

        var mapIndicator;
        $.ajax({
            url: `api/indicatorv2`,
            method: 'GET',
            success: function (response) {
                mapIndicator = response;
            },
            error: function (error) {
                console.error('Error fetching updated data:', error);
            }
        });


        let timeout = 0;
        let lastMd5 = ''
        let lastAJAX = 0

        let res;






        function status() {
            var z = zoomOptions.zoom.wheel.enabled || zoomOptions.zoom.pinch.enabled || zoomOptions.zoom.drag.enabled
            var f = (z) => {
                return z ? 'enabled' : 'disabled'
            }
            statusZoom.innerHTML = "Status Zoom " + f(z) + " Pan " + f(zoomOptions.pan.enabled)
        }

        var charts = [
            ...maChart
        ]


        var vnindexDataIndex = 0;
        var order = ["ALL", "VNINDEX", "LARGE", "8300", "8600", "8700", "MIDDLE", "SMALL", "HNX", "2700", "1700", "2300", "3500", "1300", "5300", "UPCOM", "0500", "9500", "7500", "3700", "3300", "5700", "6500", "4500", "8500", "5500"]
        var order2 = ["8300", "8600", "8700", "2700", "1700", "2300", "3500", "1300", "5300", "0500", "9500", "7500", "3700", "3300", "5700", "6500", "4500", "8500", "5500"]
        var searchSymbol;
        let c = (x) => {
            return x ? x : 0
        }
        let sum = (x) => {
            x.total_vol = c(x.sd_vol) + c(x.bu_vol) + c(x.unknown_vol)
            x.total_val = c(x.sd_val) + c(x.bu_val) + c(x.unknown_val)
            return { total_vol: x.total_vol, total_val: x.total_val }
        }

        var colors = Array(2000).fill().map(e => getRandomColor());
        var mapColor = {};
        Object.keys(map).forEach((s, i) => {
            mapColor[s] = colors[i];
        })
        mapColor = { "AAA": "#757F8F", "AAM": "#DCB154", "AAT": "#EE3350", "ABR": "#9AC509", "ABS": "#509591", "ABT": "#DDEA7B", "ACB": "#59871E", "ACC": "#C198DB", "ACG": "#30CCF1", "ACL": "#390190", "ADG": "#968550", "ADP": "#D5AAD7", "ADS": "#9C9170", "AGG": "#AE6F84", "AGM": "#AE1129", "AGR": "#02FCFB", "ANV": "#0B29C9", "APC": "#9B3F33", "APG": "#83C768", "APH": "#F8FED9", "ASG": "#113660", "ASM": "#995213", "ASP": "#11F802", "AST": "#4A48EE", "BAF": "#550B56", "BBC": "#997C30", "BCE": "#96154E", "BCG": "#220182", "BCM": "#911C39", "BFC": "#8ABE61", "BHN": "#6958B9", "BIC": "#D476D1", "BID": "#5DC75C", "BKG": "#864250", "BMC": "#87804F", "BMI": "#9DF085", "BMP": "#6D1EAD", "BRC": "#6C5853", "BSI": "#E3E13C", "BTP": "#045831", "BTT": "#57A687", "BVH": "#B7697C", "BWE": "#CE2DB4", "C32": "#A138FB", "C47": "#B842E9", "CAV": "#C9D183", "CCI": "#996D86", "CCL": "#D83D7A", "CDC": "#846253", "CHP": "#B92977", "CIG": "#E9BFE4", "CII": "#FD2BF5", "CKG": "#E412E9", "CLC": "#1D9F2A", "CLL": "#92E3C0", "CLW": "#577631", "CMG": "#1CA93E", "CMV": "#941A74", "CMX": "#4192D6", "CNG": "#0499EC", "COM": "#41611B", "CRC": "#EF3613", "CRE": "#45F56E", "CSM": "#2F7096", "CSV": "#6A979B", "CTD": "#BBD9EC", "CTF": "#AB122B", "CTG": "#F191AF", "CTI": "#7FA47C", "CTR": "#BA81EA", "CTS": "#9C6A99", "CVT": "#C7FB37", "D2D": "#AFDD6E", "DAG": "#35A133", "DAH": "#D9DF19", "DAT": "#99358F", "DBC": "#D0505E", "DBD": "#74417B", "DBT": "#2A33F3", "DC4": "#054060", "DCL": "#A84C42", "DCM": "#6BCDD9", "DGC": "#4101A3", "DGW": "#287241", "DHA": "#18F876", "DHC": "#F9DEF3", "DHG": "#D406B8", "DHM": "#0605B7", "DIG": "#42C316", "DLG": "#4511EC", "DMC": "#99D753", "DPG": "#4299AA", "DPM": "#78CE6A", "DPR": "#CCD97F", "DQC": "#D4EECE", "DRC": "#48955E", "DRH": "#F692C8", "DRL": "#228CA3", "DSN": "#4A10CE", "DTA": "#43B330", "DTL": "#DAC648", "DTT": "#DD72F8", "DVP": "#A4F4F7", "DXG": "#EC98C3", "DXS": "#4E3C73", "DXV": "#4F5EEB", "EIB": "#1E0146", "ELC": "#674DAB", "EVE": "#FF2426", "EVF": "#B9DBD7", "EVG": "#D33878", "FCM": "#621D7A", "FCN": "#79478E", "FDC": "#8E8FEE", "FIR": "#CCE962", "FIT": "#38AF9F", "FMC": "#91AD76", "FPT": "#667E60", "FRT": "#162793", "FTS": "#ECDE0B", "FUCTVGF3": "#AA87C4", "FUCTVGF4": "#FDAC00", "FUCVREIT": "#0AC885", "GAS": "#A846B0", "GDT": "#D29644", "GEG": "#A21ABD", "GEX": "#CFCB61", "GIL": "#CBF0D3", "GMC": "#6DEDB4", "GMD": "#412A91", "GMH": "#E4AB13", "GSP": "#31B8A3", "GTA": "#DAAAA0", "GVR": "#3A4D91", "HAG": "#C4E11F", "HAH": "#6FCDA8", "HAP": "#8B955A", "HAR": "#A7CD79", "HAS": "#49D0F1", "HAX": "#671765", "HBC": "#D49637", "HCD": "#5A1C6D", "HCM": "#FA3BEE", "HDB": "#5DFADD", "HDC": "#80AA34", "HDG": "#79C07E", "HHP": "#F96E9E", "HHS": "#4DAE90", "HHV": "#31C1CF", "HID": "#ECA3D3", "HII": "#052C46", "HMC": "#4F63D5", "HNG": "#1A9ECC", "HPG": "#432750", "HPX": "#6A6B2B", "HQC": "#7BC260", "HRC": "#756933", "HSG": "#99D3F6", "HSL": "#24197F", "HT1": "#C2AEA5", "HTI": "#786EAC", "HTL": "#2FA400", "HTN": "#0DD11D", "HTV": "#B945C1", "HU1": "#C4B377", "HUB": "#0F3376", "HVH": "#DBB3C4", "HVN": "#0EB3E4", "HVX": "#E0E280", "IBC": "#BFE5CE", "ICT": "#962727", "IDI": "#F6E750", "IJC": "#8303AA", "ILB": "#519CD2", "IMP": "#B344D2", "ITA": "#B3F2DD", "ITC": "#021364", "ITD": "#A0EF9A", "JVC": "#4740CE", "KBC": "#D49734", "KDC": "#E9036F", "KDH": "#B11E7F", "KHG": "#460606", "KHP": "#BF8D2C", "KMR": "#41D5E9", "KOS": "#21B09E", "KPF": "#E106E5", "KSB": "#CD7C07", "L10": "#AD2D08", "LAF": "#250A1A", "LBM": "#C44226", "LCG": "#F4652B", "LDG": "#3D5829", "LEC": "#E7E358", "LGC": "#37CB8C", "LGL": "#120C67", "LHG": "#CDDE7D", "LIX": "#46BD6F", "LM8": "#5A93CA", "LPB": "#9587C9", "LSS": "#881406", "MBB": "#E710A9", "MCP": "#581731", "MDG": "#01FD04", "MHC": "#72978D", "MIG": "#773140", "MSB": "#3F3E14", "MSH": "#477924", "MSN": "#F00697", "MWG": "#4A63D9", "NAF": "#380C27", "NAV": "#A19F12", "NBB": "#427CD9", "NCT": "#2053CB", "NHA": "#EF39C9", "NHH": "#65282B", "NHT": "#024947", "NKG": "#137C66", "NLG": "#7E9C17", "NNC": "#7AD191", "NO1": "#157C93", "NSC": "#260503", "NT2": "#ABD48D", "NTL": "#CFB69B", "NVL": "#025AC3", "NVT": "#D637AA", "OCB": "#1DE301", "OGC": "#5FFEC1", "OPC": "#DCC7D9", "ORS": "#AD8511", "PAC": "#DCC9FA", "PAN": "#AB2E40", "PC1": "#41BAF3", "PDN": "#21A473", "PDR": "#557ED3", "PET": "#4A1C0F", "PGC": "#ACB27F", "PGD": "#86B03E", "PGI": "#EE9D75", "PGV": "#6659A9", "PHC": "#4AE0AF", "PHR": "#F81F9E", "PIT": "#6C94B2", "PJT": "#5AD20E", "PLP": "#5A283B", "PLX": "#7A5572", "PMG": "#3C8B48", "PNC": "#F0756D", "PNJ": "#7D46A4", "POM": "#7EAABD", "POW": "#5516FB", "PPC": "#E9DFB7", "PSH": "#703B9A", "PTB": "#988858", "PTC": "#A86262", "PTL": "#FC10F3", "PVD": "#8CD78E", "PVP": "#BD6BA5", "PVT": "#4A6A6E", "QBS": "#77C708", "QCG": "#C6A442", "RAL": "#6171F4", "RDP": "#1292B8", "REE": "#222B5B", "S4A": "#2AA5D2", "SAB": "#B5B5F5", "SAM": "#07CC16", "SAV": "#C3A31E", "SBA": "#3FC171", "SBT": "#00D354", "SBV": "#93430F", "SC5": "#457E40", "SCD": "#B2E386", "SCR": "#72385D", "SCS": "#C4999D", "SFC": "#513FAE", "SFG": "#D27656", "SFI": "#A1C9A9", "SGN": "#B66BEA", "SGR": "#8EFF46", "SGT": "#575C6A", "SHA": "#9F67CF", "SHB": "#4B520F", "SHI": "#3FAB81", "SHP": "#3D0816", "SIP": "#964A3D", "SJD": "#AC0F30", "SJF": "#01842F", "SJS": "#7A8F3C", "SKG": "#70DAE2", "SMA": "#5E2613", "SMB": "#37E8E2", "SMC": "#F7AE59", "SPM": "#DECA9F", "SRC": "#B941B2", "SRF": "#B088C7", "SSB": "#F68239", "SSC": "#4EF54F", "SSI": "#746655", "ST8": "#EF13CC", "STB": "#663441", "STG": "#323A7C", "STK": "#A6F0D7", "SVC": "#4B16FD", "SVD": "#546332", "SVI": "#DA1749", "SVT": "#8260FB", "SZC": "#E87DC4", "SZL": "#236DB7", "TBC": "#673CBB", "TCB": "#FD1BDE", "TCD": "#B11653", "TCH": "#885279", "TCL": "#47FE0C", "TCM": "#55E38C", "TCO": "#794707", "TCR": "#7682E0", "TCT": "#1EF32B", "TDC": "#819D1F", "TDG": "#3D24BE", "TDH": "#842844", "TDM": "#C3E7FB", "TDP": "#E05208", "TDW": "#38461E", "TEG": "#D169B5", "TGG": "#92F160", "THG": "#570640", "TIP": "#3D67F4", "TIX": "#E15380", "TLD": "#D8974E", "TLG": "#02D6DE", "TLH": "#39D171", "TMP": "#68A860", "TMS": "#416133", "TMT": "#D37B69", "TN1": "#D894C6", "TNA": "#C3641E", "TNC": "#DF3EE5", "TNH": "#D724A1", "TNI": "#31036A", "TNT": "#9F660A", "TPB": "#4A9D78", "TPC": "#6CBD5C", "TRA": "#BAA5EC", "TRC": "#F2E7A1", "TSC": "#6F000F", "TTA": "#143474", "TTB": "#16D337", "TTE": "#DFF5AE", "TTF": "#E35548", "TV2": "#867DBF", "TVB": "#D46BC9", "TVS": "#5F3BC9", "TVT": "#AB7908", "TYA": "#633209", "UIC": "#5EC57D", "VAF": "#84AF93", "VCA": "#4CDD1F", "VCB": "#6E4374", "VCF": "#3ABDD4", "VCG": "#4B884D", "VCI": "#F9BF49", "VDP": "#2A743F", "VDS": "#3691B3", "VFG": "#6BCE01", "VGC": "#113ED7", "VHC": "#74ADFB", "VHM": "#B655BD", "VIB": "#2B3BF5", "VIC": "#F85679", "VID": "#02D9EB", "VIP": "#936C12", "VIX": "#DA0B6B", "VJC": "#4D9E7C", "VMD": "#C7A2E1", "VND": "#C9A8E6", "VNE": "#C1E53C", "VNG": "#22CB0E", "VNL": "#BABBBD", "VNM": "#44C38E", "VNS": "#9D2F12", "VOS": "#C4D696", "VPB": "#00BB4B", "VPD": "#4FCE51", "VPG": "#4B783C", "VPH": "#3742EE", "VPI": "#8A3C25", "VPS": "#49D9BF", "VRC": "#FBCA3B", "VRE": "#ED7061", "VSC": "#BB4DEA", "VSH": "#A1F5E7", "VSI": "#922369", "VTB": "#969E64", "VTO": "#789562", "YBM": "#F08C4C", "YEG": "#CE37DA", "AAV": "#92ED29", "ADC": "#43937C", "ALT": "#824648", "AMC": "#1DA82F", "AME": "#AA3F98", "AMV": "#386720", "API": "#5CBC9E", "APS": "#FCB76B", "ARM": "#6BDDAE", "ATS": "#9518F9", "BAB": "#AE2D72", "BAX": "#3F2AD0", "BBS": "#A1DB80", "BCC": "#84E197", "BCF": "#4B27D8", "BDB": "#89886F", "BED": "#413F2A", "BKC": "#255584", "BLF": "#DCA17D", "BNA": "#DCD5B0", "BPC": "#DC7572", "BSC": "#C21FC3", "BST": "#ABD2ED", "BTS": "#65E868", "BTW": "#BDAAD6", "BVS": "#FFE3A2", "BXH": "#F652F0", "C69": "#F38FE5", "CAG": "#407683", "CAN": "#6627D7", "CAP": "#422B4F", "CCR": "#B7D38D", "CDN": "#AB2BE0", "CEO": "#E93ECC", "CET": "#852AB1", "CIA": "#106CE0", "CJC": "#D05BB9", "CKV": "#2C83BA", "CLH": "#1E7343", "CLM": "#F8BC47", "CMC": "#45671B", "CMS": "#1B94D1", "CPC": "#17E079", "CSC": "#872707", "CTB": "#0BCF6C", "CTC": "#619598", "CTP": "#455807", "CTT": "#4420B5", "CTX": "#9459F7", "CVN": "#C0179B", "CX8": "#D97DA8", "D11": "#A2E406", "DAD": "#0D639C", "DAE": "#399FE9", "DC2": "#113013", "DDG": "#79787D", "DHP": "#D26AC0", "DHT": "#E97A8F", "DIH": "#9A8E76", "DL1": "#3A95A2", "DNC": "#DE468A", "DNP": "#E25200", "DP3": "#380BF7", "DPC": "#E36201", "DS3": "#0D6F62", "DST": "#1ED8DD", "DTC": "#E224EF", "DTD": "#E07B3A", "DTG": "#274152", "DTK": "#CFD81F", "DVG": "#BBA166", "DVM": "#B8E0C0", "DXP": "#0A9325", "DZM": "#8A43E8", "EBS": "#E2C523", "ECI": "#64596D", "EID": "#4639FA", "EVS": "#0A4706", "FID": "#CD9347", "GDW": "#8DD401", "GIC": "#F52CC0", "GKM": "#17E2BA", "GLT": "#AEB544", "GMA": "#F5C72F", "GMX": "#390795", "HAD": "#C9FCFA", "HAT": "#F6E1B7", "HBS": "#640DAC", "HCC": "#5A29D4", "HCT": "#86A7BE", "HDA": "#F3C5C0", "HEV": "#D06C0B", "HGM": "#1B1540", "HHC": "#1DBC48", "HJS": "#B82387", "HKT": "#E49407", "HLC": "#6AB9E0", "HLD": "#D1DC04", "HMH": "#F11B46", "HMR": "#13BF95", "HOM": "#823271", "HTC": "#19F8E3", "HTP": "#F87988", "HUT": "#717775", "HVT": "#883E04", "ICG": "#50F051", "IDC": "#AEF226", "IDJ": "#98A771", "IDV": "#E7F427", "INC": "#772119", "INN": "#A21010", "IPA": "#E1005C", "ITQ": "#B88530", "IVS": "#A4FC5A", "KDM": "#204152", "KHS": "#483E40", "KKC": "#14CA48", "KLF": "#617730", "KMT": "#FFB6CC", "KSD": "#46E625", "KSF": "#4C3608", "KSQ": "#87F78D", "KST": "#B138D9", "KSV": "#EC273B", "KTS": "#8430FC", "KTT": "#52F02E", "L14": "#E2696A", "L18": "#819981", "L40": "#BDA0F0", "L43": "#5364F5", "L61": "#AE0B3B", "L62": "#5DA474", "LAS": "#06265B", "LBE": "#9AB9B0", "LCD": "#8CD59B", "LDP": "#4B8AB0", "LHC": "#FBEF57", "LIG": "#2F09A6", "MAC": "#F01D3D", "MAS": "#696F5B", "MBG": "#0E0DE7", "MBS": "#CD4F5A", "MCC": "#CF75A9", "MCF": "#59EC6B", "MCO": "#3A5544", "MDC": "#5ED3CD", "MED": "#800B6B", "MEL": "#E4C4CF", "MHL": "#1A817A", "MIM": "#4622C5", "MKV": "#1CA804", "MST": "#56F8AE", "MVB": "#FDCD36", "NAG": "#459AAF", "NAP": "#A82CDE", "NBC": "#FE7A6B", "NBP": "#D69D49", "NBW": "#386905", "NDN": "#64FFD8", "NDX": "#A0BCA9", "NET": "#59B585", "NFC": "#044CA4", "NHC": "#16A9F6", "NRC": "#1FD209", "NSH": "#7C5164", "NST": "#2AFA54", "NTH": "#BB767E", "NTP": "#2CBEAF", "NVB": "#82DA50", "OCH": "#34FBF2", "ONE": "#F016D0", "PBP": "#710881", "PCE": "#DC4CB5", "PCG": "#43F7D8", "PCH": "#AD2112", "PCT": "#0E55A8", "PDB": "#7F41DC", "PEN": "#0875C8", "PGN": "#6EE2D4", "PGS": "#34B5A6", "PGT": "#3C82EE", "PHN": "#B43DCA", "PIA": "#78856E", "PIC": "#7DB313", "PJC": "#A4B31F", "PLC": "#D55ECE", "PMB": "#37B622", "PMC": "#F7FF92", "PMP": "#9D1971", "PMS": "#E4C4B0", "POT": "#A21347", "PPE": "#520396", "PPP": "#E7115A", "PPS": "#F5D14A", "PPT": "#32AE7B", "PPY": "#18709E", "PRC": "#93C82B", "PRE": "#9D21C6", "PSC": "#F12162", "PSD": "#33F3C0", "PSE": "#25F684", "PSI": "#A83DD2", "PSW": "#58BA4F", "PTD": "#118A1D", "PTI": "#B27D09", "PTS": "#A12708", "PV2": "#47A041", "PVB": "#72DCB1", "PVC": "#3E2634", "PVG": "#E06E79", "PVI": "#10C962", "PVS": "#0C9BFA", "QHD": "#38F9EA", "QST": "#A74402", "QTC": "#39CDAF", "RCL": "#42B17B", "S55": "#07084A", "S99": "#D7DBE3", "SAF": "#12BDFF", "SCG": "#D20BBC", "SCI": "#5BAECC", "SD5": "#887791", "SD6": "#25E28F", "SD9": "#0A833B", "SDA": "#4287A0", "SDC": "#B2D686", "SDG": "#2D3435", "SDN": "#6DED3E", "SDT": "#3E0020", "SDU": "#6819B7", "SEB": "#4799C6", "SED": "#547B9B", "SFN": "#AEE408", "SGC": "#6B7EDF", "SGD": "#8A16C7", "SGH": "#53B6FE", "SHE": "#4669AF", "SHN": "#FBFB48", "SHS": "#D04F7E", "SJ1": "#6DB839", "SJE": "#606F70", "SLS": "#B9BBD3", "SMN": "#5E86D2", "SMT": "#8773FD", "SPC": "#745573", "SPI": "#E82D5D", "SRA": "#6A6D68", "SSM": "#ACBAD0", "STC": "#6B4A1B", "STP": "#E1D00A", "SVN": "#1BB3C9", "SZB": "#3E4F8F", "TA9": "#8ABD34", "TAR": "#DE68E3", "TBX": "#117115", "TC6": "#2B779E", "TDN": "#66CFFE", "TDT": "#2AF7AC", "TET": "#C5B0F7", "TFC": "#050A51", "THB": "#3E39A4", "THD": "#4C0331", "THS": "#408075", "THT": "#ED7772", "TIG": "#BEDAB2", "TJC": "#31AE0B", "TKC": "#927DF9", "TKG": "#715808", "TKU": "#948AF7", "TMB": "#0593D4", "TMC": "#C11EB2", "TMX": "#072A70", "TNG": "#157A38", "TOT": "#76DC11", "TPH": "#342BE6", "TPP": "#C88759", "TSB": "#D003BC", "TTC": "#47B4F4", "TTH": "#18EF21", "TTL": "#A7AF09", "TTT": "#4F637D", "TTZ": "#451EDD", "TV3": "#274B44", "TV4": "#9E4232", "TVC": "#95C255", "TVD": "#EC616F", "TXM": "#4AE6F7", "UNI": "#F52EF1", "V12": "#FA4799", "V21": "#DE4EFE", "VBC": "#AFD144", "VC1": "#FEB3CD", "VC2": "#FCAEB4", "VC3": "#94F3EE", "VC6": "#9DE92A", "VC7": "#B6F1BC", "VC9": "#C478AE", "VCC": "#533B0A", "VCM": "#BD39DD", "VCS": "#3FBEBF", "VDL": "#C9DF5B", "VE1": "#DD730B", "VE3": "#0AB160", "VE4": "#AE24F2", "VE8": "#1D75AF", "VFS": "#222B40", "VGP": "#79D332", "VGS": "#E22CDF", "VHE": "#534B79", "VHL": "#8A6668", "VIF": "#2E77D3", "VIG": "#51E1E8", "VIT": "#2D2E20", "VLA": "#25F0B2", "VMC": "#6AA514", "VMS": "#10CD4B", "VNC": "#B03AF6", "VNF": "#6D0A66", "VNR": "#5484D2", "VNT": "#E0B3B4", "VSA": "#29AB07", "VSM": "#E61CB8", "VTC": "#0DE2DA", "VTH": "#1565DB", "VTJ": "#14D8A8", "VTV": "#00C917", "VTZ": "#32CE08", "WCS": "#7A328F", "WSS": "#106912", "X20": "#51A321", "A32": "#071816", "AAS": "#B39E6F", "ABB": "#8D76F4", "ABC": "#08BC11", "ABI": "#94841B", "ABW": "#D6CEFE", "ACE": "#C7D782", "ACM": "#3DE4BB", "ACS": "#051D95", "ACV": "#9E8B9A", "AFX": "#E55181", "AG1": "#03A7DA", "AGF": "#C6455B", "AGP": "#7D3945", "AGX": "#C4D95A", "AIC": "#948D30", "ALV": "#C59C86", "AMD": "#E71AEB", "AMP": "#28D894", "AMS": "#B5BFC6", "ANT": "#838B40", "APF": "#0CB1B0", "APL": "#2D1AA2", "APP": "#C7A8A2", "APT": "#7BDE32", "ART": "#EE5CD0", "ASA": "#C23181", "ATA": "#C37529", "ATB": "#4EC6F7", "ATG": "#0F999D", "AVC": "#396006", "AVF": "#B15831", "B82": "#A492EC", "BAL": "#D24A27", "BBH": "#3B48F5", "BBM": "#8478AC", "BBT": "#75E41D", "BCA": "#2388EF", "BCB": "#1DA398", "BCP": "#78B2C6", "BCV": "#E4B113", "BDG": "#3A329F", "BDT": "#C4D9BC", "BDW": "#74F475", "BEL": "#D966F5", "BGW": "#2F64D2", "BHA": "#21753D", "BHC": "#CD8430", "BHG": "#C61A1E", "BHI": "#CF1863", "BHK": "#1C40AC", "BHP": "#7500AF", "BIG": "#DFFE45", "BII": "#6C8211", "BIO": "#310F9A", "BLI": "#FC93E6", "BLN": "#9BA071", "BLT": "#E73BD2", "BLW": "#A43F2A", "BMD": "#C32AEC", "BMF": "#1BF2C0", "BMG": "#27119A", "BMJ": "#087B1F", "BMN": "#6682F4", "BMS": "#DE6EC0", "BMV": "#E6D44C", "BNW": "#E74E0F", "BOT": "#0E22BB", "BQB": "#A10616", "BRR": "#A0489B", "BRS": "#C1FD56", "BSA": "#877FB8", "BSD": "#9597EA", "BSG": "#50DB1B", "BSH": "#61249F", "BSL": "#2A7460", "BSP": "#B96A36", "BSQ": "#6392B6", "BSR": "#1B9024", "BT1": "#D15920", "BT6": "#851A94", "BTB": "#9520D4", "BTD": "#D19449", "BTG": "#5F5047", "BTH": "#D0EC11", "BTN": "#A553F1", "BTU": "#255CA0", "BTV": "#28CA5D", "BVB": "#625938", "BVG": "#689BEA", "BVL": "#A09E73", "BVN": "#D1262E", "BWA": "#D39244", "BWS": "#0682E7", "C12": "#149CFD", "C21": "#97EF33", "C22": "#98F2D7", "C4G": "#17C6AA", "C92": "#999A15", "CAB": "#B1F075", "CAD": "#A9BA4E", "CAR": "#AD79EC", "CAT": "#298787", "CBI": "#1F27EE", "CBS": "#199716", "CC1": "#62A890", "CC4": "#22C0FB", "CCA": "#375940", "CCM": "#19D91D", "CCP": "#883BBF", "CCT": "#BF7448", "CCV": "#EF9FED", "CDG": "#7247DA", "CDH": "#0D070E", "CDO": "#32D5A3", "CDP": "#1B335B", "CDR": "#036613", "CE1": "#DE5FD2", "CEG": "#95BCE9", "CEN": "#D84C24", "CFM": "#D58FE9", "CFV": "#82A712", "CGV": "#D7C04E", "CH5": "#E08F01", "CHC": "#187527", "CHS": "#9BBE87", "CI5": "#970EEE", "CID": "#062C76", "CIP": "#6CC97E", "CK8": "#6B7E44", "CKA": "#389B03", "CKD": "#CDAB26", "CLG": "#737BD5", "CLX": "#B6F9DA", "CMD": "#244C35", "CMF": "#E36D6C", "CMI": "#46C921", "CMK": "#2A5035", "CMM": "#2439E6", "CMN": "#BE1922", "CMP": "#623DA5", "CMT": "#97B9CF", "CMW": "#152D33", "CNA": "#B94869", "CNC": "#F994A2", "CNN": "#46E7C8", "CNT": "#5F750A", "CPA": "#FA2E8D", "CPH": "#A52FEE", "CPI": "#FBBAD2", "CQN": "#03FCBD", "CQT": "#D6CD0E", "CSI": "#9E6A02", "CST": "#828D80", "CT3": "#88609C", "CT6": "#B89EF8", "CTA": "#68E4AE", "CTN": "#E4019B", "CTW": "#F265EA", "CYC": "#CD414D", "DAC": "#6FD277", "DAN": "#E88AE6", "DAS": "#4A9693", "DBM": "#34CA44", "DC1": "#2603B4", "DCF": "#80D723", "DCG": "#38DE84", "DCH": "#A68531", "DCR": "#F7717E", "DCS": "#9A67CF", "DCT": "#303037", "DDH": "#DD39DF", "DDM": "#2008B0", "DDN": "#FF60E2", "DDV": "#3AF8EE", "DFC": "#83531D", "DFF": "#2D4DAD", "DGT": "#AACBDC", "DHB": "#AAF7C6", "DHD": "#CFC99E", "DHN": "#F06307", "DIC": "#438278", "DID": "#C92576", "DKC": "#CE2418", "DLD": "#D2AF3C", "DLM": "#EE5D43", "DLR": "#019A5C", "DLT": "#C2A4A6", "DM7": "#C90258", "DMN": "#B0AFE9", "DMS": "#3ADEE5", "DNA": "#6E91F2", "DND": "#479414", "DNE": "#457922", "DNH": "#D7DCF3", "DNL": "#58CB24", "DNM": "#1D48D1", "DNN": "#2A61D5", "DNT": "#3626BC", "DNW": "#8FEE1C", "DOC": "#46277D", "DOP": "#E8AB4D", "DP1": "#70CD4C", "DP2": "#62B31A", "DPH": "#7DDB56", "DPP": "#B71339", "DPS": "#797FEB", "DRG": "#E5E471", "DRI": "#B4F117", "DSC": "#3139F5", "DSD": "#60DD3F", "DSG": "#7DCA2F", "DSP": "#D3DF51", "DSV": "#6E2889", "DTB": "#857E21", "DTE": "#71D6F5", "DTH": "#E2CD73", "DTI": "#0FDAD2", "DTP": "#51DC84", "DTV": "#31A64D", "DUS": "#95804F", "DVC": "#8E4FC9", "DVN": "#A68E23", "DVW": "#A67728", "DWC": "#47059C", "DWS": "#DC85E8", "DXL": "#C94936", "E12": "#8247C7", "E29": "#CAB410", "EFI": "#0392AC", "EIC": "#2AFAD6", "EIN": "#3C5478", "EME": "#F5B7D8", "EMG": "#445D8C", "EMS": "#3152CE", "EPC": "#95131B", "EPH": "#198213", "FBA": "#935E20", "FBC": "#AC4CD0", "FCC": "#4C1F3A", "FCS": "#6A3503", "FGL": "#BAA4F7", "FHN": "#C4012F", "FHS": "#05402F", "FIC": "#F1ABD5", "FLC": "#175FBC", "FOC": "#09DFA7", "FOX": "#120574", "FRC": "#536B04", "FRM": "#52EAD8", "FSO": "#DEBAEB", "FT1": "#695A19", "FTI": "#BF8ED1", "FTM": "#CEFA84", "G20": "#FA8053", "G36": "#254383", "GAB": "#A4E4CB", "GCB": "#D4F70F", "GCF": "#99B7A4", "GDA": "#F8157E", "GEE": "#2E14A4", "GER": "#99AB5C", "GGG": "#A8DB49", "GH3": "#95FF6B", "GHC": "#543623", "GLC": "#13BB77", "GLW": "#D1273E", "GND": "#CF7C2F", "GPC": "#EFB57B", "GSM": "#803179", "GTD": "#BBB206", "GTS": "#C0FA34", "GTT": "#C88B6F", "GVT": "#0FF599", "H11": "#79123C", "HAC": "#5F3EE7", "HAF": "#C01FA3", "HAI": "#48BBFE", "HAM": "#02C9BA", "HAN": "#5508E7", "HAV": "#A801E9", "HBD": "#8DA96C", "HBH": "#3068EC", "HC1": "#E1EF00", "HC3": "#048F89", "HCB": "#BC4275", "HCI": "#9DA622", "HD2": "#462384", "HD6": "#02A387", "HD8": "#FF6711", "HDM": "#C0B9C6", "HDO": "#0CA08C", "HDP": "#9255CA", "HDW": "#BD55EF", "HEC": "#1BEF74", "HEJ": "#7936ED", "HEM": "#73C2B8", "HEP": "#0373D9", "HES": "#6D92A7", "HFB": "#054207", "HFC": "#07ED27", "HFX": "#44AEE9", "HGT": "#552454", "HGW": "#A32443", "HHG": "#0F2433", "HHN": "#A44693", "HHR": "#B5AC96", "HIG": "#1FC8FA", "HJC": "#93866B", "HKB": "#2D0465", "HLA": "#658533", "HLB": "#2BD712", "HLR": "#B8B1CD", "HLS": "#52B7FB", "HLT": "#DD6BFE", "HLY": "#F1D2DA", "HMG": "#DEF68C", "HMS": "#640053", "HNA": "#C02CF3", "HNB": "#EF0E07", "HND": "#91749A", "HNF": "#D7463E", "HNI": "#2375B1", "HNM": "#44DDD7", "HNP": "#9DA23C", "HNR": "#88BD79", "HOT": "#45BA49", "HPB": "#78CA0A", "HPD": "#1F63B5", "HPH": "#60EB5F", "HPI": "#D62615", "HPM": "#7273B7", "HPP": "#374FCA", "HPT": "#9437E7", "HPW": "#DD64B9", "HRB": "#96CD23", "HRT": "#7F4F61", "HSA": "#295327", "HSI": "#55E3AE", "HSM": "#6B3B2A", "HSP": "#BB6EA4", "HSV": "#40BC5D", "HTE": "#6F2C6B", "HTG": "#6AEDA1", "HTM": "#F76F0A", "HTT": "#FA184B", "HU3": "#096C3D", "HU4": "#C453BF", "HU6": "#39C155", "HUG": "#58A893", "HVA": "#C0181D", "HVG": "#BC1122", "HWS": "#D4256B", "IBD": "#E95471", "ICC": "#D5E75A", "ICF": "#928D7F", "ICI": "#B3902E", "ICN": "#326A71", "IDP": "#816924", "IFS": "#108A86", "IHK": "#85221F", "ILA": "#B3C08B", "ILC": "#49CBC7", "ILS": "#906105", "IME": "#495D9A", "IN4": "#09BB9A", "IRC": "#7EAA56", "ISG": "#293B71", "ISH": "#1726AA", "IST": "#8F19CC", "ITS": "#D6891B", "JOS": "#BC5862", "KAC": "#787AE9", "KCB": "#B0E669", "KCE": "#5C31A0", "KGM": "#8D9E3C", "KHD": "#9AFFF1", "KHL": "#DE624B", "KHW": "#E9DA2F", "KIP": "#848A10", "KLB": "#3ED725", "KLM": "#9CAA5C", "KSH": "#311079", "KTC": "#94832C", "KTL": "#5E4C65", "KVC": "#DAFCD3", "L12": "#E04861", "L35": "#2FDD62", "L44": "#7E99F1", "L45": "#C7773E", "L63": "#62A6E4", "LAI": "#385874", "LAW": "#662F73", "LBC": "#16659B", "LCC": "#A35EFA", "LCM": "#74EED3", "LCS": "#EDB194", "LDW": "#85FD46", "LG9": "#E097E1", "LGM": "#441374", "LIC": "#3646E0", "LKW": "#4F76E7", "LLM": "#9009F5", "LM3": "#5DC292", "LM7": "#C377E8", "LMC": "#2EEE8F", "LMH": "#12EDEF", "LMI": "#29BA41", "LNC": "#E1A86E", "LO5": "#FCC2F0", "LPT": "#EE9D3E", "LQN": "#C56A09", "LSG": "#756EC1", "LTC": "#6B843B", "LTG": "#2C06D9", "LUT": "#FE41E6", "M10": "#9F0FA0", "MA1": "#A2A220", "MBN": "#AD9426", "MCD": "#6092C6", "MCG": "#DC6379", "MCH": "#7A8525", "MCM": "#25E6B7", "MDA": "#0A059B", "MDF": "#5A5EEB", "MEC": "#7EE3A1", "MEF": "#7CDBE2", "MES": "#4991C5", "MFS": "#75E7E8", "MGC": "#62F0C0", "MGG": "#A81681", "MGR": "#6110E0", "MH3": "#870A03", "MIC": "#5B5EDD", "MIE": "#8569F2", "MKP": "#983748", "MLC": "#EB68E7", "MLS": "#49EBD3", "MML": "#6F2E14", "MNB": "#7D5F1B", "MND": "#B28FFE", "MPC": "#74FE50", "MPT": "#E80488", "MPY": "#94F59B", "MQB": "#B798FD", "MQN": "#5BB585", "MRF": "#E4197B", "MSR": "#C13BD7", "MTA": "#66EC68", "MTB": "#B98BD2", "MTC": "#C45342", "MTG": "#01145D", "MTH": "#BA0F2C", "MTL": "#ED2309", "MTP": "#26C47B", "MTS": "#6FB132", "MTV": "#DFB2AE", "MVC": "#67E1F3", "MVN": "#72FC28", "NAB": "#D31DF4", "NAC": "#B8CB1A", "NAS": "#D16C85", "NAU": "#ADC6E3", "NAW": "#E50979", "NBE": "#DC8B7C", "NBT": "#0446A7", "NCS": "#48B80A", "ND2": "#3C2B30", "NDC": "#16B9FE", "NDF": "#519AC2", "NDP": "#6D686D", "NDT": "#09B86E", "NDW": "#2D881C", "NED": "#310AFF", "NGC": "#8A26E3", "NHP": "#2B978E", "NHV": "#F22564", "NJC": "#B521FA", "NLS": "#93E88E", "NNT": "#59DFF2", "NOS": "#45E81A", "NQB": "#8AFB17", "NQN": "#CDA048", "NQT": "#7D7214", "NS2": "#07B881", "NSG": "#03F24D", "NSL": "#BE942E", "NSS": "#5DA3D1", "NTB": "#D7CE98", "NTC": "#8B8B9E", "NTF": "#32BCC3", "NTT": "#C8ABB4", "NTW": "#DED0FA", "NUE": "#5C1EC5", "NVP": "#96322D", "NWT": "#40DDDB", "NXT": "#55EAD2", "ODE": "#795418", "OIL": "#9B7F83", "ONW": "#F296C2", "PAI": "#21FC74", "PAP": "#3CDADF", "PAS": "#362FFD", "PAT": "#0383A4", "PBC": "#72E4C4", "PBT": "#08A130", "PCC": "#1798F6", "PCF": "#B76A7A", "PCM": "#5A53E1", "PCN": "#A817C7", "PDC": "#870BBC", "PDV": "#29AC97", "PEC": "#2EA74E", "PEG": "#CA885D", "PEQ": "#3005B3", "PFL": "#4114F6", "PGB": "#4E9B3A", "PHH": "#5F5569", "PHP": "#AFE994", "PHS": "#EB8446", "PID": "#4C2CA9", "PIS": "#0C83B0", "PIV": "#43EDD3", "PJS": "#8C135E", "PLA": "#DE37B6", "PLE": "#8BF3BF", "PLO": "#A6D15A", "PMJ": "#BCBDF1", "PMT": "#E6E373", "PMW": "#59D5A6", "PND": "#DE510B", "PNG": "#66BD91", "PNP": "#ADAF9F", "PNT": "#42E457", "POB": "#BDE234", "POS": "#9A0B6D", "POV": "#BE10A0", "PPH": "#7717F3", "PPI": "#0308F9", "PQN": "#A81950", "PRO": "#983EC1", "PRT": "#F5AFA5", "PSB": "#1687AF", "PSG": "#9068F3", "PSL": "#769E12", "PSN": "#5DE4BD", "PSP": "#B71E6F", "PTE": "#D93D6E", "PTG": "#84A084", "PTH": "#2B1651", "PTN": "#B400D4", "PTO": "#BD0C87", "PTP": "#F06B4B", "PTT": "#D191F0", "PTV": "#92FA46", "PTX": "#3B6935", "PVA": "#092074", "PVE": "#760A7A", "PVH": "#A73657", "PVL": "#8204CE", "PVM": "#290B32", "PVO": "#A3B6BD", "PVR": "#10058C", "PVV": "#406BBE", "PVX": "#A39E4C", "PVY": "#9C1482", "PWA": "#9364E9", "PWS": "#6292B2", "PX1": "#7A324C", "PXA": "#129D93", "PXC": "#16926F", "PXI": "#FD27EE", "PXL": "#D31DDA", "PXM": "#92047B", "PXS": "#D1170D", "PXT": "#4A0EC7", "QCC": "#914462", "QHW": "#7CE5E9", "QNC": "#953063", "QNS": "#112D09", "QNT": "#DC6E15", "QNU": "#DAFF80", "QNW": "#C17F83", "QPH": "#EF415A", "QSP": "#EADE07", "QTP": "#D57286", "RAT": "#C94F61", "RBC": "#798EF0", "RCC": "#A38F1E", "RCD": "#4886F5", "RGC": "#D2AABA", "RIC": "#88CC3C", "RTB": "#940B1D", "S12": "#D9A8C5", "S27": "#79ECE7", "S72": "#99F5C0", "S74": "#67E386", "S96": "#E54BCE", "SAC": "#F66998", "SAL": "#17CC5A", "SAP": "#D2A7AC", "SAS": "#CD8B45", "SB1": "#EF26B0", "SBD": "#0EFA59", "SBH": "#79C8DA", "SBL": "#B9B81D", "SBM": "#F64B00", "SBR": "#8C189F", "SBS": "#335578", "SCC": "#FB5446", "SCJ": "#1B6E4D", "SCL": "#BCB43E", "SCO": "#BA87EB", "SCY": "#3C0004", "SD1": "#579D70", "SD2": "#4E5EB8", "SD3": "#E9EBA8", "SD4": "#1DF303", "SD7": "#540D61", "SD8": "#5C34F8", "SDB": "#465B89", "SDD": "#E9F6C9", "SDJ": "#31597D", "SDK": "#B85055", "SDP": "#EAAE5B", "SDV": "#304DA7", "SDX": "#2AA8E5", "SDY": "#AB179E", "SEA": "#6E6D2A", "SEP": "#44439B", "SGB": "#62F5A6", "SGI": "#351D3F", "SGO": "#1D6876", "SGP": "#4F6A89", "SGS": "#21DE73", "SHC": "#44EEA2", "SHG": "#13D094", "SHX": "#9213E2", "SID": "#F8088A", "SIG": "#715540", "SII": "#DF872C", "SIV": "#7A6CAA", "SJC": "#93C8C3", "SJG": "#4102F2", "SJM": "#FA90BC", "SKH": "#E51B25", "SKN": "#E1E98A", "SKV": "#3FFA6B", "SNC": "#C3A7A4", "SNZ": "#2145C2", "SP2": "#82E893", "SPB": "#C57BAF", "SPD": "#E6DB48", "SPH": "#607985", "SPV": "#E9DEB3", "SQC": "#F50A96", "SRB": "#E49E27", "SRT": "#FEAE3B", "SSF": "#371F7B", "SSG": "#4C847C", "SSH": "#3AA73B", "SSN": "#CF8CAB", "STH": "#E81DF7", "STL": "#B45E8A", "STS": "#685012", "STT": "#DBA7D1", "STW": "#AB2947", "SVG": "#530458", "SVH": "#AC4BB2", "SWC": "#ED8894", "SZE": "#D697AE", "SZG": "#DFBEAD", "TA3": "#7165F7", "TA6": "#02E89E", "TAN": "#A9540D", "TAW": "#86F922", "TB8": "#DA20C6", "TBD": "#F55514", "TBH": "#D461E4", "TBR": "#6AC9A5", "TBT": "#811E6B", "TCI": "#947EE0", "TCJ": "#008308", "TCK": "#240D85", "TCW": "#EBE459", "TDB": "#6A94FD", "TDF": "#3DD458", "TDS": "#AF580A", "TED": "#286B05", "TEL": "#7298B9", "TGP": "#7C266E", "TH1": "#F01485", "THN": "#CE9D54", "THP": "#11C0AD", "THU": "#156E02", "THW": "#D94FB4", "TID": "#6977BA", "TIE": "#F2570F", "TIN": "#F8AEBD", "TIS": "#60AAE9", "TKA": "#CB402A", "TL4": "#606A6C", "TLI": "#9DD72E", "TLP": "#B4AC52", "TLT": "#B855BD", "TMG": "#AB4D32", "TMW": "#EB37AC", "TNB": "#04E226", "TNM": "#A95AF3", "TNP": "#BB8C0C", "TNS": "#EBFC15", "TNW": "#8F4D2B", "TOP": "#1948D0", "TOS": "#57601D", "TOW": "#17563C", "TPS": "#F47F02", "TQN": "#34E39C", "TQW": "#CF4B57", "TR1": "#2ABA92", "TRS": "#5371DA", "TRT": "#609340", "TS3": "#4D4D99", "TS4": "#C28C72", "TSD": "#42CE13", "TSG": "#9EBC88", "TSJ": "#0FA342", "TST": "#347BA6", "TTD": "#842D76", "TTG": "#945D5A", "TTN": "#30DA03", "TTP": "#79A251", "TTS": "#E3E042", "TUG": "#B8C2F9", "TV1": "#BF16CD", "TV6": "#FCC3EF", "TVA": "#2618CA", "TVG": "#BAB67F", "TVH": "#EFAF58", "TVM": "#47C853", "TVN": "#A83556", "TVP": "#262633", "TW3": "#EB8159", "UCT": "#9D2CBA", "UDC": "#70A1EE", "UDJ": "#A1E9D7", "UDL": "#102E8B", "UEM": "#7932B8", "UMC": "#D60FAE", "UPC": "#FD3A40", "UPH": "#40C3D4", "USC": "#B3F731", "USD": "#25FB20", "V11": "#01512F", "V15": "#1359ED", "VAB": "#768BFF", "VAV": "#CE6A06", "VBB": "#6122D3", "VBG": "#920938", "VBH": "#5DAAA7", "VC5": "#5EE3B5", "VCE": "#1356C2", "VCP": "#299F4C", "VCR": "#0947DA", "VCT": "#855654", "VCW": "#336D4A", "VCX": "#5C9B4F", "VDB": "#4D40CE", "VDN": "#733CBB", "VDT": "#E1C997", "VE2": "#5C07F3", "VE9": "#0AAB25", "VEA": "#6ABDEE", "VEC": "#07FCBD", "VEF": "#3E12C8", "VES": "#561B20", "VET": "#CB9E8F", "VFC": "#8E92E3", "VFR": "#260BCD", "VGG": "#A30961", "VGI": "#645460", "VGL": "#0C7816", "VGR": "#C1EEF7", "VGT": "#0532DE", "VGV": "#4FB9BB", "VHD": "#D426A0", "VHF": "#D3F90B", "VHG": "#C125C7", "VHH": "#8015D3", "VIE": "#E9435D", "VIH": "#0C471D", "VIM": "#EA9120", "VIN": "#EDACEE", "VIR": "#177C2F", "VIW": "#21DC1A", "VKC": "#BB8108", "VKP": "#B6B5ED", "VLB": "#1DA421", "VLC": "#D50934", "VLF": "#95EF35", "VLG": "#56C493", "VLP": "#5A0F22", "VLW": "#C13F57", "VMA": "#303D12", "VMG": "#73D0A6", "VMT": "#4C1A15", "VNA": "#7285EA", "VNB": "#6FEA13", "VNH": "#917FA8", "VNI": "#30580C", "VNP": "#52FA38", "VNX": "#11EE89", "VNY": "#C5D67E", "VNZ": "#CC4255", "VOC": "#0B8F93", "VPA": "#89CBFC", "VPC": "#535775", "VPR": "#6178E6", "VPW": "#E952A1", "VQC": "#73BC00", "VRG": "#ABE4D6", "VSE": "#DE4714", "VSF": "#E3A75A", "VSG": "#6CA68C", "VSN": "#DC8D3A", "VST": "#F8BB79", "VTA": "#C4F552", "VTD": "#31943D", "VTE": "#44B856", "VTG": "#823FEB", "VTI": "#6B387D", "VTK": "#7660E8", "VTL": "#E3BAF7", "VTM": "#5EFBCF", "VTP": "#7B61AA", "VTQ": "#EE7B8A", "VTR": "#4A9D3E", "VTS": "#41E2FA", "VTX": "#2E56C7", "VUA": "#05523A", "VVN": "#2BF62A", "VVS": "#968437", "VW3": "#4534FE", "VWS": "#44E826", "VXB": "#B854A6", "VXP": "#B97526", "VXT": "#069199", "WSB": "#026863", "WTC": "#B4BDF2", "X26": "#389503", "X77": "#82FC5A", "XDC": "#956C1A", "XDH": "#390BDE", "XHC": "#14936B", "XLV": "#F18A56", "XMC": "#0647D5", "XMD": "#776942", "XMP": "#9499EE", "XPH": "#A4789D", "YBC": "#ABB543", "YTC": "#F83FAC" }
        var VNINDEX = {}

        function updateDataTable() {
            if (Date.now() - lastAJAX <= timeout) {
                return;
            }


            $.ajax({
                url: querydate ? '/api/index?querydate=' + querydate : `api/index`,
                method: 'GET',
                success: function (res) {
                    Object.entries(res).forEach((e) => {
                        VNINDEX[e[0]] = e[1]
                    })
                },
                error: function (error) {
                    console.error('Error fetching updated data:', error);
                }
            })

            $.ajax({
                url: querydate ? '/api/getsymbolsaccum?querydate=' + querydate : `api/getsymbolsaccum`,
                method: 'GET',
                success: function (response) {

                    if (response.length == 0) {
                        return;
                    }
                    res = response.filter(e => {
                        sum(e);
                        var ret = e.total_vol >= volMin && e.total_val >= valMin
                        if (minpct) ret = ret && e.pct >= minpct;
                        if (maxpct) ret = ret && e.pct <= maxpct;
                        return ret
                    }).filter(e => !e.symbol.includes('VN30F'))

                    labels = res.map(e => e.symbol);
                    var colorA = labels.map(e => {
                        if (sectorcolor)
                            return mapColorSymbolSector[e]
                        else
                            return mapColor[e]
                    });

                    labels.push('VNINDEX')
                    res.push({
                        "symbol": "VNINDEX",
                        "time": "14:56",
                        "T": "1706108160",
                        "price": VNINDEX.VNINDEX,
                        "priceref": 18400,
                        "ceiling": 20200,
                        "floor": 16600,
                        "change": VNINDEX.change,
                        "pct": VNINDEX.pct,
                        "unknown_vol": 891900,
                        "unknown_val": 16410960000,
                        "open": VNINDEX.open,
                        "close": VNINDEX.VNINDEX,
                        "high": VNINDEX.high,
                        "low": VNINDEX.low,
                        "sd_vol": 0,
                        "sd_val": 0,
                        "bu_vol": VNINDEX.vol,
                        "bu_val": VNINDEX.val,
                        "bid_vol": 0,
                        "bid_val": 0,
                        "ask_vol": 0,
                        "ask_val": 0,
                        "busd_vol": 0,
                        "busd_val": 0,
                        "total_vol": VNINDEX.vol,
                        "total_val": VNINDEX.val
                    })

                    var maxRealR = 0;
                    var minRealR = 100000000;


                    data = res.map(e => {
                        try {
                            sum(e);
                            var indicator = mapIndicator[e.symbol]
                            // console.log(e.symbol,indicator)
                            var price_total = indicator[mapIndicator.HEAD['price_total_100']];
                            var price_total_array = short_day.map(e => indicator[mapIndicator.HEAD['price_total_' + e]])
                            var val30 = indicator[mapIndicator.HEAD['val_30']];
                            var ratio = 1000;
                            if (e.symbol === 'VNINDEX') ratio = 1;
                            var sma20 = (price_total * ratio + e.price) / 100
                            var sma_array = price_total_array.map((p, i) => { return Math.round((p * ratio + e.price) / short_day[i] * 100) / 100 })
                            var sma_array_old = short_day.map(sd => {
                                return mapIndicator[e.symbol][mapIndicator.HEAD['price_ma_' + sd]]
                            })

                            var pct20 = (e.price - sma20) / sma20 * 100

                            var pct_array = sma_array.map((sma, i) => {
                                if (mapIndicator[e.symbol][mapIndicator.HEAD['price_ma_' + short_day[i]]] == null) return null
                                return Math.round((e.price - sma) / sma * 10000) / 100
                            })

                            var bb_pct_array = bb.map((key, i) => {
                                var bb_at_key = mapIndicator[e.symbol][mapIndicator.HEAD['price_bb_' + key]];
                                if (bb_at_key == null) return null
                                if (e.symbol === 'VNINDEX') {
                                    // console.log('price_bb_' + key,e.price,bb_at_key)
                                }
                                return Math.round((e.price - bb_at_key * ratio) / (bb_at_key * ratio) * 10000) / 100
                            })

                            if (mapIndicator[e.symbol][mapIndicator.HEAD['price_ma_100']] == null) pct20 = 0
                            // console.log(e.price,indicator[mapIndicator.HEAD['price_ma_20']],sma20,pct20)

                            // var r = Math.floor(Math.sqrt(e.pct * e.pct + (e.total_val / 1e10) * (e.total_val / 1e10)) * 100) / 100;

                            var r = Math.floor(Math.sqrt(e.total_val / val30 * e.total_val / val30 + (e.total_val / 1e10) * (e.total_val / 1e10)) * 100) / 100;

                            if (r === Infinity) {
                                r = 100
                                console.log('Infinity: ', e.symbol, e)
                            }

                            // var r = Math.floor(Math.sqrt(e.pct * e.pct + (pct20)*(pct20)) * 100) / 100;

                            if (minr && r < minr) r = minr - Math.sqrt(minr - r);
                            if (maxr && r > maxr) r = maxr + Math.sqrt(r - maxr);

                            if (e.bu_val && e.sd_val && (e.bu_val < e.sd_val)) {
                                e.total_val = -e.total_val
                                e.busd_val = e.bu_val - e.sd_val
                            }

                            var ma = {}
                            short_day.forEach((sd, i) => {
                                ma['pct_ma_' + sd] = pct_array[i]
                                ma['price_ma_' + sd] = sma_array[i]
                                ma['price_ma_p_' + sd] = mapIndicator[e.symbol][mapIndicator.HEAD['price_ma_' + sd]]
                            })

                            bb.forEach((sd, i) => {   
                                ma['pct_bb_' + sd] = bb_pct_array[i]
                                ma['price_bb_p_' + sd] = mapIndicator[e.symbol][mapIndicator.HEAD['price_bb_' + sd]]
                                // console.log(e.symbol,'price_bb_p_' + sd,ma['price_bb_p_' + sd])
                            })

                            var xVal = mapPosSymbolSector[e.symbol]
                            if (e.symbol === 'VNINDEX') xVal = 50

                            if (searchSymbol && e.symbol.toUpperCase() === searchSymbol.toUpperCase()) {
                                if (r < 40) r = 40 * 1.5
                                if (r >= 40) r = r * 1.5;
                            }

                            var ret = { busd: e.busd_val, symbol: e.symbol, ...e, ...ma }

                            short_day.forEach(sd => {
                                var yVal = ma['pct_ma_' + sd]
                                ret[sd] = { x: xVal, y: yVal, r: r, ...ma }
                            })

                            bb.forEach((sd, i) => {
                                var yVal =  ma['pct_bb_' + sd]
                                ret[sd] = { x: xVal, y: yVal, r: r, ...ma }
                            })

                            return ret;
                        } catch (error) {
                            console.log(error, e.symbol)
                        }

                    });
                    // console.table(data)
                    // combineChart.data.labels = labels;
                    // combineChart.data.datasets[0].data = data;
                    // combineChart.data.datasets[0].backgroundColor = colorA
                    // combineChart.data.datasets[0].borderColor = colorA
                    // combineChart.update()
                    let key = [...short_day, ...bb];
                    maChart.forEach((chart, i) => {
                        chart.data.labels = labels;
                        var VNI;
                        chart.data.datasets[0].data = data.map(e => {
                            if (e.symbol === 'VNINDEX') VNI = { ...e[key[i]], ...e }
                            return { ...e[key[i]], ...e }
                        });

                        if (VNI.y) {
                            chart.options.plugins.annotation.annotations.vnindex.yMax = VNI.y;
                            chart.config.options.plugins.annotation.annotations.vnindex.yMin = VNI.y;
                        }
                        chart.data.datasets[0].backgroundColor = colorA
                        chart.data.datasets[0].borderColor = colorA
                        chart.update()
                    })
                    // console.log('Update-----')
                    lastAJAX = Date.now()
                },
                error: function (error) {
                    console.error('Error fetching updated data:', error);
                }
            });
        }
        // Update DataTable every 5 seconds (adjust as needed)
        updateDataTable();//first
        setInterval(updateDataTable, interval * 1000);

        $(document).ready(function () {
            $('#mytable').DataTable();
            $('.tooltip').tooltipster();
        });



        function resetChart() {
            resetZoomCb()
            charts.forEach(c => {
                c.resetZoom()
                c.update();
            })

            status()
        }

        function toggleZoom() {
            console.log("Toggle Zoom")
            zoomOptions.zoom.wheel.enabled = !zoomOptions.zoom.wheel.enabled;
            zoomOptions.zoom.pinch.enabled = !zoomOptions.zoom.pinch.enabled;
            zoomOptions.zoom.drag.enabled = !zoomOptions.zoom.drag.enabled;

            charts.forEach(c => {
                if (c) {
                    c.update();
                }
            })
            status()

        }

        function togglePan() {
            console.log("Toggle Pan")
            zoomOptions.pan.enabled = !zoomOptions.pan.enabled;
            charts.forEach(c => {
                if (c) {
                    c.update();
                }
            })
            status()
        }

        function changeChart() {
            if (chartType.toLowerCase() != 'bar') {
                chartType = 'bar';
                chartTypeBtn.innerHTML = '(<span class="underlined-red">C</span>) Line';
            } else {
                chartType = 'line';
                chartTypeBtn.innerHTML = '(<span class="underlined-red">C</span>) Bar';
            }
            charts.forEach(c => {
                if (c) {
                    c.config.type = chartType;
                    c.update();

                }
            })

        }

        function vnindex() {
            charts.forEach(c => {
                if (c) {
                    c.data.datasets[vnindexDataIndex].hidden = !c.data.datasets[vnindexDataIndex].hidden
                    c.update();
                }
            })
        }

        function hide() {
            if (combineDiv.style.display !== 'none')
                combineDiv.style.display = 'none'
            else
                combineDiv.style.display = ''
        }

        var keyIsPressed = false;
        var disableKey = false;
        document.addEventListener('keydown', function (event) {
            if (!keyIsPressed && !disableKey) {
                keyIsPressed = true;
                switch (event.key.toUpperCase()) {
                    case 'C':
                        chartTypeBtn.classList.add('key-pressed');
                        setInterval(() => {
                            chartTypeBtn.classList.remove('key-pressed');
                        }, 2000)
                        changeChart();
                        break;
                    case 'R':
                        resetChart();
                        break;
                    case 'Z':
                        toggleZoom();
                        break;
                    case 'P':
                        togglePan();
                        break;
                    case 'V':
                        vnindex();
                        break;
                    case 'S':
                        savePageAsPDF();
                        break;
                    case 'B':
                        back()
                        break;
                    case 'N':
                        next()
                        break;
                    case 'H':
                        hide();
                        break;
                }
                keyIsPressed = false;
            }
        });

        status()

        function back() {
            if (!selectedDate) selectedDate = moment().format('YYYYMMDD')
            selectedDate = getPreviousDay(selectedDate)
            queryDateInput.value = moment(selectedDate, 'YYYYMMDD').format('YYYY-MM-DD')
            handleDateChange(selectedDate);
        }

        function next() {
            if (!selectedDate) selectedDate = moment().format('YYYYMMDD')
            selectedDate = getNextDay(selectedDate)
            queryDateInput.value = moment(selectedDate, 'YYYYMMDD').format('YYYY-MM-DD')
            handleDateChange(selectedDate);
        }


        function getPreviousDay(currentDay) {
            var d = moment(currentDay, 'YYYYMMDD');
            if (d.isoWeekday() === 1) {
                return d.subtract(3, 'days').format('YYYYMMDD')
            }
            if (d.isoWeekday() === 7) {
                return d.subtract(2, 'days').format('YYYYMMDD')
            }
            if (d.isoWeekday() >= 2 && d.isoWeekday() <= 6) {
                return d.subtract(1, 'days').format('YYYYMMDD')
            }
        }
        function getNextDay(currentDay) {
            var d = moment(currentDay, 'YYYYMMDD');
            if (d.isoWeekday() === 5) {
                return d.add(3, 'days').format('YYYYMMDD')
            }
            if (d.isoWeekday() === 6) {
                return d.add(2, 'days').format('YYYYMMDD')
            }
            if (d.isoWeekday() >= 1 && d.isoWeekday() <= 4 || d.isoWeekday() == 7) {
                return d.add(1, 'days').format('YYYYMMDD')
            }
        }

        var selectedDate;

        queryDateInput.addEventListener('change', function (event) {
            selectedDate = event.target.value;
            console.log('Selected Date:', selectedDate);
            selectedDate = moment(selectedDate, 'YYYY-MM-DD').format("YYYYMMDD")
            // Gọi hàm xử lý sự kiện khi ngày thay đổi
            handleDateChange(selectedDate);
        });

        function handleDateChange(selectedDate) {
            querydate = selectedDate;
            updateDataTable()
        }

        function savePageAsPDF() {
            // Lấy toàn bộ nội dung của trang
            const content = document.body;

            // Cài đặt các tùy chọn cho quá trình chuyển đổi sang PDF
            const options = {
                margin: 10,
                filename: 'myWebPage.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a1', orientation: 'landscape' }
            };

            // Sử dụng html2pdf để chuyển đổi và lưu trang web thành file PDF
            html2pdf(content, options);
        }

        document.getElementById("code_filter").onclick = function () {
            code_filter.value = ''
            disableKey = true;
        };

        var search = (value) => {
            searchSymbol = value
            var index = -1;
            maChart[0].data.labels.forEach((v, i) => {
                if (v.toUpperCase() === searchSymbol.toUpperCase()) {
                    index = i;
                }
            })

            if (index >= 0) {
                console.log("index", index)
                maChart.forEach(combineChart => {
                    if (combineChart.data.datasets[0].data[index].r < 40) {
                        combineChart.data.datasets[0].data[index].r = 40 * 1.5
                        combineChart.data.datasets[0].data[index].order = 100000
                    }
                    if (combineChart.data.datasets[0].data[index].r >= 40) {
                        combineChart.data.datasets[0].data[index].r = combineChart.data.datasets[0].data[index].r * 1.5
                        combineChart.data.datasets[0].data[index].order = 1000000
                    }
                    combineChart.update()
                })

            }
        }
        document.getElementById("code_filter").onchange = function () {
            search(code_filter.value)
            console.log('Done code_filter')
            disableKey = false;
        };

        code_filter.addEventListener('input', function (event) {
            // Lấy giá trị hiện thời của ô văn bản
            var currentValue = event.target.value;
            search(currentValue)
            // Hiển thị giá trị trong console (hoặc xử lý giá trị theo nhu cầu)
            console.log('Giá trị hiện thời:', currentValue);
        });

    </script>
</body>

</html>