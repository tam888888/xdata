<!-- index.html -->
<!DOCTYPE html>
<html>

<head>
    <title>Master Page</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>Sector Chart</title>
    <script src="https://github.com/tam888888/stockData/releases/download/1.0.0/filter.js"></script>
    <script src="https://github.com/tam888888/stockData/releases/download/1.0.0/symbols.js"></script>
    <script src="https://github.com/tam888888/stockData/releases/download/1.0.0/ssi.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
    <!-- <script src="https://cdn.datatables.net/scroller/2.3.0/js/dataTables.scroller.min.js"></script> -->
    <script src="https://cdn.datatables.net/keytable/2.11.0/js/dataTables.keyTable.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.colVis.min.js"></script>
    <script src="https://cdn.datatables.net/fixedcolumns/4.3.0/js/dataTables.fixedColumns.min.js"></script>
    <script src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>

    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/fixedcolumns/4.3.0/css/fixedColumns.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/scroller/2.3.0/css/scroller.dataTables.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/keytable/2.11.0/css/keyTable.dataTables.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">


    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"
        integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>

    <link rel="stylesheet" type="text/css" href="tooltipster.bundle.min.css">
    <script type="text/javascript" charset="utf8"
        src="https://github.com/tam888888/stockData/releases/download/1.0.0/tooltipster.bundle.min.js"></script>

    <style>
        div.dataTables_wrapper div.dataTables_info {
            padding-top: 0px;
        }

        div.dataTables_wrapper div.dataTables_info {
            font-size: 6px;
            /* Set font size for information text (e.g., "Showing 1 to 10 of 100 entries") */
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        table,
        th,
        td {
            border: 1px solid #ccc;
        }

        th,
        td {
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
    <style>
        /* CSS for limiting the number of rows and adding a vertical scroll */
        #timelineContainer {
            max-height: 600px;
            /* Set the maximum height for the table */
            overflow-y: auto;
            /* Enable vertical scrolling */
        }
    </style>
    <style>
        /* CSS for enabling both horizontal and vertical scrolling for the entire page */
        body,
        html {
            overflow: scroll;
            /* Enable both horizontal and vertical scrolling for the entire page */
        }
    </style>
    <style>
        /* #chartcontainer {
            text-align: center;
        }

        #vnindex,#busd {
            display: inline;
        } */
        #chartcontainer {
            display: flex;
            justify-content: center;
        }

        #combineDiv {
            display: flex;
            /* flex-wrap: wrap; */
            /* Cho phép các ô chuyển hàng khi không đủ không gian */
            /* justify-content: center; */
        }

        .hidden-element {
            display: none;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 700px);
            /* 3 cột trong mỗi hàng */
            grid-gap: 10px;
            /* Khoảng cách giữa các ô */
            /* grid-auto-rows: 300px; */
        }

        .grid-item {
            /* Định dạng cho mỗi ô trong grid */
            border: 1px solid #ddd;
            padding: 10px;
            width: 700px;
            /* Chiều rộng của mỗi ô */
            height: 700px;
            /* Chiều cao của mỗi ô */
        }

        .flex-container {
            display: flex;
            flex-wrap: wrap;
            /* Cho phép các ô chuyển hàng khi không đủ không gian */
            justify-content: center;
        }

        .flex-item3 {
            flex: 0 0 calc(33.33% - 20px);
            /* 33.33% chiều rộng mỗi ô, trừ đi khoảng cách giữa các ô */
            box-sizing: border-box;
            /* Đảm bảo padding và border không làm tăng kích thước thực tế của ô */
            margin: 10px;
            /* Khoảng cách giữa các ô */
        }

        .flex-item2 {
            flex: 0 0 calc(50% - 20px);
            /* 33.33% chiều rộng mỗi ô, trừ đi khoảng cách giữa các ô */
            box-sizing: border-box;
            /* Đảm bảo padding và border không làm tăng kích thước thực tế của ô */
            margin: 10px;
            /* Khoảng cách giữa các ô */
        }

        .flex-item1 {
            flex: 0 0 calc(100% - 20px);
            /* 33.33% chiều rộng mỗi ô, trừ đi khoảng cách giữa các ô */
            box-sizing: border-box;
            /* Đảm bảo padding và border không làm tăng kích thước thực tế của ô */
            margin: 10px;
            /* Khoảng cách giữa các ô */
        }

        .flex-itemOne {
            flex: 0 0 calc(80% - 20px);
            /* 33.33% chiều rộng mỗi ô, trừ đi khoảng cách giữa các ô */
            box-sizing: border-box;
            /* Đảm bảo padding và border không làm tăng kích thước thực tế của ô */
            margin: 10px;
            /* Khoảng cách giữa các ô */
        }

        .custom-link {
            text-decoration: none !important;
        }

        /* .tooltip {
            position: absolute;
            z-index: 1;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
            display: none;
        } */

        .tooltipContainer {
            overflow: hidden;
            position: relative;
            display: inline-block;
            border: 2px solid #007bff;
            /* Đường viền màu xanh */
            border-radius: 10px;
            /* Bo tròn */
            padding: 0px;
            background-color: FloralWhite;
        }

        .tooltipHeader {
            position: relative;
            display: inline-block;
            border: 2px solid #007bff;
            /* Đường viền màu xanh */
            border-radius: 10px;
            /* Bo tròn */
            padding: 10px;
        }

        .custom-theme {
            background-color: #8a2be2;
            /* Purple background color */
            color: #fff;
            /* White text color */
            border-radius: 5px;
            /* Rounded corners */
        }

        .my-custom-theme {
            border-radius: none;
            border: none;
            background: rgba(0, 0, 0, 0);
            color: #000;
            border-color: rgba(0, 0, 0, 0);
        }

        /* Use this next selector to style things like font-size and line-height: */
        .my-custom-theme .tooltipster-content {
            font-family: Arial, sans-serif;
            font-size: 14px;
            line-height: 16px;
            padding: 8px 10px;
            background: lightyellow;
            color: #111010;
            border-radius: none;
            border: none;
        }

        .scrollable-div {
            width: 100%;
            /* Set the width as needed */
            /* max-height: 700px; */
            /* height: 700px; */
            /* Set the height as needed */
            overflow: auto;
            /* Enable scrolling */
            border: 1px solid #ccc;
            /* Optional: Add a border for better visibility */
        }

        .container-div {
            width: 100%;
            /* Set the width as needed */
            /* Set the height as needed */
            overflow: auto;
            /* Enable scrolling */
            border: 1px solid #ccc;
            /* Optional: Add a border for better visibility */
            /* position: relative; */
            /* Add position property */
            z-index: 2;
            /* Add higher z-index */

            left: 0px;
        }

        .master-div {
            width: 100%;
            /* Set the width as needed */
            /* height: 800px; */
            max-height: 800px;
            /* Set the height as needed */
            overflow: auto;
            /* Enable scrolling */
            border: 1px solid #ccc;
            /* Optional: Add a border for better visibility */
            /* position: relative; */
            /* Add position property */
            z-index: 2;
            /* Add higher z-index */
        }

        .title-div {
            margin-top: 20px;
            margin-bottom: 20px;
            width: 100%;
            /* position: fixed; */
            top: 0;
            left: 50%;
            /* transform: translateX(-50%);             */
            /* Set the width as needed */
            /* justify-content: center; */
            text-align: center;
            color: #ff7300;
            /* Set the height as needed */
            overflow: auto;
            /* Enable scrolling */
            /* border: 1px solid #ccc; */
            /* Optional: Add a border for better visibility */
            /* z-index: 999; */
        }


        .title-div span {
            font-size: 52px;
            font-weight: bold;
        }

        .sumDiv {
            width: 100%;
            /* Add styling for the AAA div */
            /* position: relative; */
            /* Add position property */
            /* z-index: 1; */
            /* Add lower z-index */
        }

        .submenu {
            margin-top: 10px;
            width: 100%;
            display: none;
        }

        .parent-menu {
            width: 100%;
            margin-bottom: 10px;
        }

        #noti {
            word-wrap: break-word
        }
    </style>
    </style>
</head>

<body>
    <div class="sidebar">
        <button id="toggleSidebar">Toggle Sidebar</button>
        <div class="overlay" id="overlay"></div>
        <ul>
            <li><a href="/chart3" target="_blank">VNINDEX</a></li>
            <li>
                <a href="#" class="parent-menu">BySellSymbols</a>
                <ul class="submenu">
                    <li><a href='/indicator?interval=60&filter=and(ge(16,200000),ct(0,"DIG","DXG","NVL","KBC","NLG","VIX","VCI"))'
                            target="_blank">Indicator Realtime WatchList</a>
                    <li><a href='/indicator?interval=60&filter=and(ge(16,200000),ctg(0,"Dịch%20vụ%20tài%20chính"))'
                            target="_blank">Indicator Chứng</a>
                    <li><a href='/indicator?interval=60&filter=and(ge(16,200000),ctg(0,"Bất động sản"))'
                            target="_blank">Indicator BĐS</a>
                    <li><a href='/indicator?interval=60&filter=and(ge(16,200),ctg(0,"Dầu Khí"))'
                            target="_blank">Indicator Dầu Khí</a>
                    <li><a href='/indicator?interval=60&filter=and(ge(16,200000),ctg(0,"Ngân Hàng"))'
                            target="_blank">Indicator Ngân Hàng</a>
                    <li><a href='/indicator?interval=60&filter=and(ge(16,200000),ctg(0,"Tài Nguyên"))'
                            target="_blank">Indicator Tài Nguyên</a>
                    <li><a href='/indicator?interval=60&filter=and(ge(16,200000),ctg(0,"Hóa Chất"))'
                            target="_blank">Indicator Hóa Chất</a>
                    <li><a href='/indicator?interval=60&filter=and(ge(16,200000),ct(0,"PTC","TXM","MEC","DHA","HMG","CMC","HPS","PPG","SD5","HBC","SDN","VTA","IJC","TV4","ACC","ACE","TV3","HCI","PVA","PEC","CTA","VC6","VHL","SKS","BCE","VCT","PVX","REM","SEL","QCC","ACS","DID","PHH","HTI","PID","CH5","CEC","LLM","CTX","PDB","MBG","TTL","HID","MCT","VIH","SBV","CEE","HTE","EME","QLD","DTB","HTN","TB8","CGV","TLD","EVG","LIC","CC4","TCK","DXD","KSF","XDC","SCG","BCC","HT1","VCG","BTS","ICC","SDT","IME","VNE","CTN","MCO","DNP","DAC","TNM","PTB","L44","B82","V21","VE3","VDT","TL4","QTC","HEC","HU3","VC5","VPC","SD1","ND2","THG","VE8","RCD","VGC","L63","KPF","TA9","C4G","VHD","TA6","TS5","SJG","TV6","BHV","DPC","SD4","HAS","VTS","SD9","VC1","SDY","CYC","LM7","VE2","MCL","H11","PSB","JSC","KBT","ADP","NNC","PXA","CTM","ICG","PVV","PTL","STV","SCI","CCH","PXC","PTE","HC3","PVH","LQN","DT4","GTS","PCC","BUD","DPG","HC1","PQN","FBC","BM9","HEJ","CDR","TDI","QNT","GH3","GMA","PCH","HMR","NXT","BT6","CID","SJE","CC1","S55","SD7","SIC","HOM","CNT","DC2","DNC","LCC","L40","SDD","HVX","TSM","SDP","CTV","SD8","V15","VCH","CX8","ICI","BHT","L35","VE1","CCM","VES","BTD","HMS","NAC","CQT","G36","L12","AMS","GND","BOT","CT5","TVH","XDH","ATB","LMI","HFB","HAM","FIC","GAB","DFF","GMH","DVG","UIC","ICN","UDC","DTV","VC2","TTC","SD6","NTP","SC5","XMC","L18","L61","CT3","SDE","LCS","S96","LCG","VCS","SDJ","VC3","VE9","QHD","GMX","SHN","LO5","CI5","L14","VCC","PXS","MCG","DGT","D26","NDX","HLD","CDG","PC1","MST","ROS","BMN","XLV","X18","C12","DCR","TGG","PCM","TS3","MES","TCD","BDC","AGE","VMC","BMP","HLY","S91","SCJ","CDC","SJC","L62","L43","SSM","VC9","LM3","V12","TDC","SDK","KCE","VC7","PHC","SCL","S27","PX1","TBT","MCC","CT6","CVN","HDA","GTH","PTD","MDG","VXB","LHC","HU1","PXT","HTB","HFX","DSG","VMI","HPM","BTU","I10","HCD","APL","NMK","HAN","GDA","TA3","VGV","MIE","SCY","BTN","HUB","C69","GKM","THD","VTV","SD3","LBM","NAV","CIC","LGC","TCR","NHC","C92","L10","HUT","VIT","TKC","UDJ","LUT","PXI","C47","SVN","DND","PXM","RCC","V11","VT1","VHH","SDH","DAG","DXV","TNY","VSI","CVT","S12","SJM","CTI","C32","HU4","VCX","VE4","ASD","DCF","VVN","AC4","XMD","TDA","VWS","CLH","NSG","C71","MCI","CCV","X77","S72","CMD","TVA","LG9","TBR","HGW","FSO","HHR","CIP","RLC","TDF","CPW","TLT","DCT","S99","SCC","SDC","SNG","DIC","CTD","SD2","TBX","S74","NHA","ALV","HCC","DC4","BVG","PSG","LIG","TMX","SDB","QNC","YBC","TVG","NSN","GHC","FCN","KHL","VRG","DC1","PEN","CDO","SDX","VLB","L45","TTB","SHG","KDM","VIW","USC","TRT","MVC","CEG","AAV","DTD","BDT","C36","DX2","NO1","HSP","VW3"))'
                            target="_blank">Indicator Xây dựng & Vật liệu</a>
                    <li><a href='/indicator?interval=60&filter=and(ge(16,200),ct(0,"ACB","BCM","BID","BVH","CTG","FPT","GAS","GVR","HDB","HPG","MBB","MSN","MWG","PLX","POW","SAB","SHB","SSB","SSI","STB","TCB","TPB","VCB","VHM","VIB","VIC","VJC","VNM","VPB","VRE"))'
                            target="_blank">Indicator VN30</a>
                    <li><a href='/indicator?interval=60&filter=and(ge(16,200),ct(0,"AAA","ACB","AGG","ANV","ASM","BCG","BCM","BID","BMP","BVH","BWE","CII","CMG","CRE","CTD","CTG","CTR","DBC","DCM","DGC","DGW","DHC","DIG","DPM","DXG","DXS","EIB","FPT","FRT","FTS","GAS","GEG","GEX","GMD","GVR","HAG","HCM","HDB","HDC","HDG","HHV","HPG","HSG","HT1","IMP","KBC","KDC","KDH","KOS","LPB","MBB","MSB","MSN","MWG","NKG","NLG","NT2","OCB","PAN","PC1","PDR","PHR","PLX","PNJ","POW","PPC","PTB","PVD","PVT","REE","SAB","SAM","SBT","SCS","SHB","SJS","SSB","SSI","STB","SZC","TCB","TCH","TMS","TPB","VCB","VCG","VCI","VGC","VHC","VHM","VIB","VIC","VIX","VJC","VND","VNM","VPB","VPI","VRE","VSH"))'
                            target="_blank">Indicator VN100</a>
                    <li><a href="/indicator?interval=60&filter=ge(16,200000)" target="_blank">Indicator Realtime</a>
                    </li>
                    <li><a href="/indicator?interval=60&filter=ge(16,200000)&querydate=20231214"
                            target="_blank">Indicator 20231214</a>
                    </li>
                    <li><a href="/indicatorstatic?interval=60&filter=ge(16,200000)" target="_blank">Indicator Days</a>
                    </li>
                    <li><a href="/chart4?interval=60&filter=ge(16,200000)" target="_blank">BySellSymbols 60 Seconds</a>
                    </li>
                    <li><a href="/chart4?interval=300&filter=ge(16,200000)" target="_blank">BySellSymbols 5 Minutes</a>
                    </li>
                    <li><a href="/chart4?interval=600&filter=ge(16,200000)" target="_blank">BySellSymbols 10 Minutes</a>
                    </li>
                    <li><a href="symbolbubble?minr=6&maxr=25&volMin=2000&valMin=3e8&sectorcolor=T&minrtext=8&minpct=-10&maxpct=10&busd=t&displaylabel=50&pctlabel=3&valminlabel=5e10"
                            target="_blank">Symbol Bubble</a></li>
                    <li><a href="symbolmabubble?minr=6&maxr=8&volMin=10000&valMin=5e8&sectorcolor=T&minrtext=8&minpct=-10&maxpct=10&busd=t&displaylabel=50&pctlabel=3&valminlabel=5e10"
                            target="_blank">Symbol Indicator</a></li>
                </ul>
            </li>
            <!-- <li><a href="/chart4?interval=60&filter=ge(16,200000)" target="_blank">BySellSymbols</a></li> -->
            <li>
                <a href="#" class="parent-menu">BuySellSectors</a>
                <ul class="submenu">
                    <li><a href="/sectors?interval=300" target="_blank">BuySellSectors</a></li>
                    <li><a href="/sectorschart?percent=x&interval=5&minVal=5000000000" target="_blank">Sector Chart With
                            Percent</a></li>
                    <li><a href="/sectorschart?interval=5&minVal=5000000000" target="_blank">Sector Chart</a></li>
                    <li><a href="/sectorschartratio?interval=5&minVal=5000000000&chart=bar" target="_blank">Sector Chart
                            Mua
                            Bán</a></li>
                    <li><a href="/sectorschartratio?interval=500&minVal=5000000000&chart=bar&querydate=20240111"
                            target="_blank">Sector Chart (QueryDate)</a></li>
                    <li><a href="/sectorschartratio?interval=5000&minVal=5000000000&chart=bar&querydate=a"
                            target="_blank">Sector Chart (QueryDateALL)</a></li>


                </ul>
            </li>
            <!-- <li><a href="/sectors?interval=300" target="_blank">BuySellSectors</a></li>
            <li><a href="/sectorschart?percent=x&interval=5&minVal=5000000000" target="_blank">Sector Chart With
                    Percent</a></li>
            <li><a href="/sectorschart?interval=5&minVal=5000000000" target="_blank">Sector Chart</a></li> -->
            <li><a href="/timeline?symbols=MSN" target="_blank">timeline</a></li>
            <li><a href="/timelinemulti?symbols=NVL,VCI,VIX,DXG,DIG,NLG,KBC" target="_blank">NVL,VCI,DXG,DIG,PDR,NLG</a>
            </li>
            <li>
                <a href="#" class="parent-menu">Investor</a>
                <ul class="submenu">
                    <li><a href='/?filter=and(dbw("trading_date","2023-10-01","2024-12-01"),ct("code","IPA","BVS","CTS","VND","TVB","IVS","SHS","TVC","ABW","ORS","PHS","HCM","HAC","TVS","ART","PV2","APS","APG","BSI","WSS","AGR","VFS","IBC","EVF","AAS","TIN","SSI","VDS","TCI","DSC","BMS","EVS","VUA","VIX","VCI","PIV","FTS","MBS","CSI","SBS","API","HBS","PSI","VIG"))&&statDay=100&&filtersum=ct("code","IPA","BVS","CTS","VND","TVB","IVS","SHS","TVC","ABW","ORS","PHS","HCM","HAC","TVS","ART","PV2","APS","APG","BSI","WSS","AGR","VFS","IBC","EVF","AAS","TIN","SSI","VDS","TCI","DSC","BMS","EVS","VUA","VIX","VCI","PIV","FTS","MBS","CSI","SBS","API","HBS","PSI","VIG")&&limit=20000'
                            target="_self">Investor Tài Chính</a></li>
                    <li><a href='/?filter=and(dbw("trading_date","2023-10-01","2024-12-01"),ct("code","NBB","C21","DIH","NVT","SID","CEO","HD2","CKG","TN1","VPI","SIP","CRE","HPX","BCM","DXS","UNI","PVR","STL","TIG","PFL","LGL","FLC","LSG","DTI","EIN","KOS","AGG","TBH","BIG","RCL","HDC","DXG","PNT","LAI","FIR","E29","SJS","CII","ITA","ITC","PPI","D11","VPH","IDV","NDN","IDJ","VNI","CLG","HU6","BAX","HTT","SZC","PLA","SSH","TDH","DIG","NTL","CSC","OCH","SZL","TNT","SGR","LEC","NTC","NVL","TID","VHM","HRB","IDC","SZB","KHG","BVL","LHG","QCG","PDR","FDC","DTA","HQC","KAC","HAR","TIP","SII","BII","SNZ","ASM","SDU","OGC","SCR","NTB","CCL","DLR","VCR","NLG","VRE","DCH","PWA","FTI","SZG","TIX","D2D","VIC","KBC","VRC","KDH","DRH","PXL","PVL","CIG","HDG","FIT","HPI","TCH","LDG","MH3","HD8","NRC","HD6","PTN","MGR"))&&statDay=100&&filtersum=ct("code","NBB","C21","DIH","NVT","SID","CEO","HD2","CKG","TN1","VPI","SIP","CRE","HPX","BCM","DXS","UNI","PVR","STL","TIG","PFL","LGL","FLC","LSG","DTI","EIN","KOS","AGG","TBH","BIG","RCL","HDC","DXG","PNT","LAI","FIR","E29","SJS","CII","ITA","ITC","PPI","D11","VPH","IDV","NDN","IDJ","VNI","CLG","HU6","BAX","HTT","SZC","PLA","SSH","TDH","DIG","NTL","CSC","OCH","SZL","TNT","SGR","LEC","NTC","NVL","TID","VHM","HRB","IDC","SZB","KHG","BVL","LHG","QCG","PDR","FDC","DTA","HQC","KAC","HAR","TIP","SII","BII","SNZ","ASM","SDU","OGC","SCR","NTB","CCL","DLR","VCR","NLG","VRE","DCH","PWA","FTI","SZG","TIX","D2D","VIC","KBC","VRC","KDH","DRH","PXL","PVL","CIG","HDG","FIT","HPI","TCH","LDG","MH3","HD8","NRC","HD6","PTN","MGR")&&limit=20000'
                            target="_self">Investor BĐS</a></li>
                    <li><a href='/?filter=and(dbw("trading_date","2023-10-01","2024-12-01"),ctg("code","Tài nguyên"))&&statDay=100&&filtersum=ctg("code","Tài Nguyên")&&limit=20000'
                            target="_self">Investor Tài Nguyên</a></li>
                    <li><a href='/?filter=and(dbw("trading_date","2023-10-01","2024-12-01"),ctg("code","Ngân Hàng"))&&statDay=100&&filtersum=ctg("code","Ngân Hàng")&&limit=20000'
                            target="_self">Investor Ngân Hàng</a></li>
                    <li><a href='/?filter=and(dbw("trading_date","2023-10-01","2024-12-01"),ct("code","DIG","DXG","NVL","KBC","NLG","VIX","VCI"))&&statDay=100&&filtersum=ct("code","DIG","DXG","NVL","KBC","NLG","VIX","VCI")&&limit=20000'
                            target="_self">Investor WatchList</a></li>
                    <li><a href="/?statDay=1" target="_self">Investor 1 day</a></li>
                    <li><a href="/?statDay=3" target="_self">Investor 3 day</a></li>
                    <li><a href="/?statDay=7" target="_self">Investor 7 day</a></li>
                    <li><a href="/?statDay=10" target="_self">Investor 10 day</a></li>
                    <li><a href="/?statDay=30" target="_self">Investor 30 day</a></li>
                    <li><a href="/?statDay=100" target="_self">Investor max day</a></li>
                    <li><a href='/?filter=ct("code","DIG","NVL","DXG","VIX","KBC","NLG","VCI","HAG","PDR")&&statDay=100&&filtersum=ct("code","DIG","NVL","DXG","VIX","KBC","NLG","VCI","HAG","PDR")'
                            target="_self">Filter Investor</a></li>
                    <li><a href='/?filter=and(ct("code","DIG","NVL","DXG","VIX","KBC","NLG","VCI","HAG","PDR"),dbw("trading_date","2023-10-01","2024-12-01"))&&statDay=100&&filtersum=ct("code","DIG","NVL","DXG","VIX","KBC","NLG","VCI","HAG","PDR")'
                            target="_self">Filter Investor 1</a></li>
                    <li><a href='/?filter=and(ct("code","DIG","NVL","DXG","VIX","KBC","NLG","VCI","HAG","PDR"),dbw("trading_date","2023-10-01","2024-12-01"))&&statDay=100'
                            target="_self">Filter Investor 2</a></li>
                    <li><a href='/?filter=dbw("trading_date","2023-11-01","2024-12-31")&&statDay=100'
                            target="_self">Filter
                            Investor 3</a></li>
                    <li><a href='/?filter=dbw("trading_date","2023-11-01","2024-12-31")&&statDay=100'
                            target="_self">Filter
                            Investor 3</a></li>
                </ul>
            </li>
            <li>
                <a href="#" class="parent-menu">FetchData</a>
                <ul class="submenu">
                    <li><a href='javascript:void(0)' onclick="fetchData(cbpre,cbpost)" target="_self">Fetch Data</a>
                    </li>
                    <li><a href='javascript:void(0)' onclick="retry()" target="_self">Retry</a></li>
                    <li><a href='javascript:void(0)' onclick="downloadData()" target="_self">Download</a></li>
                    <li><a href='javascript:void(0)' onclick="postData()" target="_self">PostData</a></li>
                    <li><a href='javascript:void(0)' onclick="postData2()" target="_self">PostData</a></li>
                    <li><a href='javascript:void(0)' onclick="fetchAndPost(cbpre,cbpost)" target="_self">Fetch and
                            Post</a></li>
                </ul>
            </li>
            <li><span id="noti">Noti</a></li>
            <!-- Add links for other charts -->
        </ul>
    </div>
    <div class="container-div">
        <div class="master-div">

            <div class="title-div">
                <span style="font-size: 52px; font-weight: bold;">Thống kê giao dịch theo tổ chức</span>
            </div>

            <table cellpadding="3" cellspacing="0" border="0" style="width: 67%; margin: 0 auto 2em auto;">
                <thead>
                    <tr>
                        <th>Target</th>
                        <th>Search text</th>
                        <th>Treat as regex</th>
                        <th>Use smart search</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="filter_global">
                        <td>Global search</td>
                        <td align="center"><input type="text" class="global_filter" id="global_filter"></td>
                        <td align="center"><input type="checkbox" class="global_filter" id="global_regex"></td>
                        <td align="center"><input type="checkbox" class="global_filter" id="global_smart"
                                checked="checked"></td>
                    </tr>
                    <tr id="filter_col1" data-column="0">
                        <td>Column - Code</td>
                        <td align="center"><input type="text" class="column_filter" id="col0_filter"></td>
                        <td align="center"><input type="checkbox" class="column_filter" id="col0_regex"></td>
                        <td align="center"><input type="checkbox" class="column_filter" id="col0_smart"
                                checked="checked"></td>
                    </tr>
                    <!-- <tr id="filter_col2" data-column="1">
                        <td>Column - trading_date</td>
                        <td align="center"><input type="text" class="column_filter" id="col1_filter"></td>
                        <td align="center"><input type="checkbox" class="column_filter" id="col1_regex"></td>
                        <td align="center"><input type="checkbox" class="column_filter" id="col1_smart"
                                checked="checked"></td>
                    </tr> -->
                    <!-- <tr id="filter_col3" data-column="2">
                        <td>Column - Office</td>
                        <td align="center"><input type="text" class="column_filter" id="col2_filter"></td>
                        <td align="center"><input type="checkbox" class="column_filter" id="col2_regex"></td>
                        <td align="center"><input type="checkbox" class="column_filter" id="col2_smart"
                                checked="checked"></td>
                    </tr>
                    <tr id="filter_col4" data-column="3">
                        <td>Column - Age</td>
                        <td align="center"><input type="text" class="column_filter" id="col3_filter"></td>
                        <td align="center"><input type="checkbox" class="column_filter" id="col3_regex"></td>
                        <td align="center"><input type="checkbox" class="column_filter" id="col3_smart"
                                checked="checked"></td>
                    </tr>
                    <tr id="filter_col5" data-column="4">
                        <td>Column - Start date</td>
                        <td align="center"><input type="text" class="column_filter" id="col4_filter"></td>
                        <td align="center"><input type="checkbox" class="column_filter" id="col4_regex"></td>
                        <td align="center"><input type="checkbox" class="column_filter" id="col4_smart"
                                checked="checked"></td>
                    </tr>
                    <tr id="filter_col6" data-column="5">
                        <td>Column - Salary</td>
                        <td align="center"><input type="text" class="column_filter" id="col5_filter"></td>
                        <td align="center"><input type="checkbox" class="column_filter" id="col5_regex"></td>
                        <td align="center"><input type="checkbox" class="column_filter" id="col5_smart"
                                checked="checked"></td>
                    </tr> -->
                </tbody>
            </table>

            <table cellpadding="3" cellspacing="0" border="0" style="width: 67%; margin: 0 auto 2em auto;">
                <thead>
                    <tr>
                        <th>Target</th>
                        <th>Range Search</th>
                        <th>From</th>
                        <th>To</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="filter_global">
                        <td>Global search</td>
                        <td align="center">
                            <form action="#" method="post">
                                <!-- <label for="dropdown">Select an option:</label> -->
                                <select id="dropdown" name="dropdown">
                                    <option value="option1">Option 1</option>
                                    <option value="option2">Option 2</option>
                                    <option value="option3">Option 3</option>
                                    <option value="option4">Option 4</option>
                                </select>

                                <!-- <input type="submit" value="Submit"> -->
                            </form>
                        </td>

                        <td align="center"><input type="text" class="global_filter1" id="global_from"></td>
                        <td align="center"><input type="text" class="global_filter1" id="global_to"></td>
                    </tr>
                    <tr id="filter_code" data-column="0">
                        <td>Column - Code</td>
                        <td align="center"><input type="text" class="column_filter1" id="code_filter"></td>
                    </tr>
                    <tr id="filter_col2" data-column="1">
                        <td>Column - trading_date</td>
                        <td align="center"><input type="date" class="column_filter1" id="td_filter"></td>
                        <td align="center"><input type="date" class="column_filter1" id="td_from"></td>
                        <td align="center"><input type="date" class="column_filter1" id="td_to"></td>
                    </tr>

                </tbody>
            </table>
            <div class="title-div">
                <button onclick="clearCache()">Clear Cache</button>
                <button onclick="search()" style="margin-left: 30px; width: 90px;">Search</button>
            </div>
            <div>
                <table id="myTable" class="display">
                    <thead id="headTable">
                        <tr>
                            <th>Sector</th>
                            <th>Thời gian</th>
                            <th>Mã Trần</th>
                            <th>Mã Tăng</th>
                            <th>Mã Đứng Giá</th>
                            <th>Mã Giảm</th>
                            <th>Mã Sàn</th>
                        </tr>
                    </thead>
                    <!-- <tfoot id="footTable">
                    <tr>
                        <th>Thống kê</th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>
                </tfoot> -->
                    <tbody>
                        <!-- Dữ liệu sẽ được thêm ở đây -->
                    </tbody>

                </table>
            </div>



        </div>
        <br />
        <div class="sumDiv">

            <div id="buttonManager">
                <span style="font-size: 24px; font-weight: bold;">10:VNINDEX 11:VN30</span>
            </div>
            <div>
                <table id="sumTable" class="display">
                    <thead id="headSumTable">
                        <tr>
                            <th>Sector</th>
                            <th>Thời gian</th>
                            <th>Mã Trần</th>
                            <th>Mã Tăng</th>
                            <th>Mã Đứng Giá</th>
                            <th>Mã Giảm</th>
                            <th>Mã Sàn</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dữ liệu sẽ được thêm ở đây -->
                    </tbody>

                </table>
            </div>
        </div>
    </div>
    <script>
        function cbpre() {
            $('#noti').text('')
        }
        function cbpost(text) {
            $('#noti').text(`Done ${text}`)
        }
        const url = new URL(window.location.href);
        const queryParams = url.searchParams;
        var date = queryParams.get('date');
        if (!date) date = '1,3,5,7,10,20,30,100'
        var statDay = queryParams.get('statDay');
        if (!statDay) statDay = 30
        else statDay = +statDay
        var limit = queryParams.get('limit');
        if (!limit) limit = 1000
        else limit = +limit
        console.log("limit", limit)
        var filterScript = queryParams.get('filter');
        if (!filterScript) filterScript = ''
        var filterSumScript = queryParams.get('filtersum');
        if (!filterSumScript) filterSumScript = ''
        var filterData;
        async function search() {
            let searchField = $('#dropdown').val()
            let globalFrom = $('#global_from').val()
            let globalTo = $('#global_to').val()
            let codeFilter = $('#code_filter').val()
            let td = $('#td_filter').val()
            let td_from = $('#td_from').val()
            let td_to = $('#td_to').val()
            if (searchField.length == 0 && codeFilter.length == 0 && td.length == 0 && td_from.length == 0 && td_to.length == 0) return
            if (codeFilter.includes(',')) {
                codeFilter = codeFilter.toUpperCase().split(',')
            }
            filterData = investorDataNew.filter(e => {
                var val = true;
                if (searchField.length > 0) {
                    if (globalFrom.length > 0) val = val && (e[searchField] >= +globalFrom)
                    if (globalTo.length > 0) val = val && (e[searchField] <= +globalTo)
                }
                if (codeFilter.length > 0) val = val && (((typeof codeFilter === 'string' && e['code'] == codeFilter.toUpperCase()) || codeFilter.includes(e['code'])))
                var date1, date2, date3;

                if (td.length > 0) {
                    date1 = (e['trading_date'] * 1000 == +moment(td, 'YYYY-MM-DD').format("x"))
                } else {
                    date1 = true;
                }
                if (td_from.length > 0) date2 = (e['trading_date'] * 1000 >= +moment(td_from, 'YYYY-MM-DD').format("x"))
                else date2 = true;
                if (td_to.length > 0) date3 = (e['trading_date'] * 1000 <= +moment(td_to, 'YYYY-MM-DD').format("x"))
                else date3 = true
                if (td.length > 0)
                    if (td_from.length > 0 || td_to.length > 0) {
                        val = val && (date1 || (date2 && date3))
                    }
                    else {
                        val = val && date1
                    }
                else {
                    val = val && (date1 && (date2 && date3))
                }

                return val;
            })

            if (filterScript && filterScript.length > 0) {
                filterData = filter(filterData, filterScript)
            }

            updateRawTable(filterData)
        }
        async function clearCache() {
            var a = await getAll()
            if (a) {
                a.forEach(e => { del(e.id) })
            }
        }

        function capitalizeFirstLetter(sentence) {
            return sentence.charAt(0).toUpperCase() + sentence.slice(1);
        }

        investorSelectField = {
            "close_value": "giá đóng cửa",
            // "total_delta": "delta tổng ",
            "foreign_delta": "delta khối ngoại",
            "proprietary_delta": "delta tự doanh",
            "local_individual_delta": "delta cá nhân(TN)",
            "local_institutional_delta": "delta tổ chức(TN)",
            "foreign_individual_delta": "delta cá nhân(NN)",
            "foreign_institutional_delta": "delta tổ chức(NN)",
            "total_buy": "tổng mua",
            "total_sell": "tổng bán",
            "total_buy_matched": "tổng mua khớp",
            "total_sell_matched": "tổng bán khớp",
            "foreign_buy_matched": "mua khối ngoại khớp",
            "foreign_sell_matched": "bán khối ngoại khớp",
            "foreign_buy": "mua khối ngoại",
            "foreign_sell": "bán khối ngoại",
            "proprietary_buy_matched": "mua tự doanh khớp",
            "proprietary_sell_matched": "bán tự doanh khớp",
            "proprietary_buy": "mua tự doanh",
            "proprietary_sell": "bán tự doanh",
            "local_individual_buy_matched": "mua cá nhân(TN) khớp",
            "local_individual_sell_matched": "bán cá nhân(TN) khớp",
            "local_individual_buy": "mua cá nhân(TN)",
            "local_individual_sell": "bán cá nhân(TN)",
            "local_institutional_buy_matched": "mua tổ chức(TN) khớp",
            "local_institutional_sell_matched": "bán tổ chức(TN) khớp",
            "local_institutional_buy": "mua tổ chức(TN)",
            "local_institutional_sell": "bán tổ chức(TN)",
            "foreign_individual_buy_matched": "mua cá nhân(NN) khớp",
            "foreign_individual_sell_matched": "bán cá nhân(NN) khớp",
            "foreign_individual_buy": "mua cá nhân(NN)",
            "foreign_individual_sell": "bán cá nhân(NN)",
            "foreign_institutional_buy_matched": "mua tổ chức(NN) khớp",
            "foreign_institutional_sell_matched": "bán tổ chức(NN) khớp",
            "foreign_institutional_buy": "mua tổ chức(NN)",
            "foreign_institutional_sell": "bán tổ chức(NN)"
        }

        let options = '<option value="">-- Select an option --</option>'
        Object.keys(investorSelectField).forEach(f => {
            investorSelectField[f] = capitalizeFirstLetter(investorSelectField[f])
            options += '<option value="' + f + '">' + investorSelectField[f] + '</option>'
        })
        $('#dropdown').html(options)

        investorFiled = { 'code': 'Mã', "trading_date": "Ngày giao dịch", ...investorSelectField }




        let table;
        function filterGlobal(table) {
            let filter = document.querySelector('#global_filter');
            let regex = document.querySelector('#global_regex');
            let smart = document.querySelector('#global_smart');

            table.search(filter.value, regex.checked, smart.checked).draw();
        }

        function filterColumn(table, i) {
            let filter = document.querySelector('#col' + i + '_filter');
            let regex = document.querySelector('#col' + i + '_regex');
            let smart = document.querySelector('#col' + i + '_smart');

            table.column(i).search(filter.value, regex.checked, smart.checked).draw();
        }



        document.querySelectorAll('input.global_filter').forEach((el) => {
            el.addEventListener(el.type === 'text' ? 'keyup' : 'change', () =>
                filterGlobal(table)
            );
        });

        document.querySelectorAll('input.column_filter').forEach((el) => {
            let tr = el.closest('tr');
            let columnIndex = tr.getAttribute('data-column');

            el.addEventListener(el.type === 'text' ? 'keyup' : 'change', () =>
                filterColumn(table, columnIndex)
            );
        });

        function formatDate(date) {
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0'); // Tháng bắt đầu từ 0
            const year = date.getFullYear();

            return `${day}/${month}/${year}`;
        }
        function formatDate2(date) {
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0'); // Tháng bắt đầu từ 0
            const year = date.getFullYear();

            return `${day}/${month}`;
        }

        // let fields = [
        //     "code", "trading_date", "close_value", "foreign_buy_matched", "foreign_sell_matched", "foreign_buy", "foreign_sell", "proprietary_buy_matched", "proprietary_sell_matched", "proprietary_buy", "proprietary_sell", "local_individual_buy_matched", "local_individual_sell_matched", "local_individual_buy", "local_individual_sell", "local_institutional_buy_matched", "local_institutional_sell_matched", "local_institutional_buy", "local_institutional_sell", "foreign_individual_buy_matched", "foreign_individual_sell_matched", "foreign_individual_buy", "foreign_individual_sell", "foreign_institutional_buy_matched", "foreign_institutional_sell_matched", "foreign_institutional_buy", "foreign_institutional_sell"
        // ]
        let fields = [...Object.keys(investorFiled)]

        // $.fn.dataTable.ext.errMode = 'none';

        let additionalTranslations = {
            // "total_delta": "delta tổng ",
            "foreign_delta": "delta khối ngoại",
            "proprietary_delta": "delta tự doanh",
            "local_individual_delta": "delta cá nhân(TN)",
            "local_institutional_delta": "delta tổ chức(TN)",
            "foreign_individual_delta": "delta cá nhân(NN)",
            "foreign_institutional_delta": "delta tổ chức(NN)",
            "acum_foreign_buy_matched": "TL Mua(NN)",
            "acum_foreign_sell_matched": "TL Bán(NN)",
            "acum_foreign_delta": "TL Delta(NN)",
            "acum_foreign_individual_delta": "TL Delta cá nhân(NN)",
            "acum_foreign_individual_buy_matched": "TL Mua cá nhân(NN)",
            "acum_foreign_individual_sell_matched": "TL Bán cá nhân(NN)",
            "acum_foreign_institutional_buy_matched": "TL Mua tổ chức(NN)",
            "acum_foreign_institutional_delta": "TL Delta tổ chức(NN)",
            "acum_foreign_institutional_sell_matched": "TL Bán(NN)",
            "acum_local_individual_buy_matched": "TL Mua cá nhân(TN)",
            "acum_local_individual_delta": "TL Delta cá nhân(TN)",
            "acum_local_individual_sell_matched": "TL Bán cá nhân(TN)",
            "acum_local_institutional_buy_matched": "TL Mua tổ chức(TN)",
            "acum_local_institutional_delta": "TL Delta tổ chức(TN)",
            "acum_local_institutional_sell_matched": "TL Bán tổ chức(TN)",
            "acum_proprietary_buy_matched": "TL Mua tự doanh",
            "acum_proprietary_delta": "TL Delta tự doanh",
            "acum_proprietary_sell_matched": "TL Bán Tự doanh",
        };
        Object.keys(additionalTranslations).forEach(f => {
            additionalTranslations[f] = capitalizeFirstLetter(additionalTranslations[f])
        })

        investorFiled2 = { ...additionalTranslations, ...investorFiled }

        var updateData = (response) => {
            response.sort((a, b) => { return b.trading_date - a.trading_date })
            var investFilterData;
            if (filterScript && filterScript.length > 0) {
                investFilterData = filter(response, filterScript)
            } else {
                investFilterData = response;
            }
            // console.table(response)
            // console.table(investFilterData)
            sheet = processInvestor(investFilterData)
            updateRawTable = (data) => {
                if (!$.fn.DataTable.isDataTable('#myTable')) {
                    statsHead = document.querySelector('#headTable')
                    statsHead.innerHTML = ''
                    var theadRow = document.createElement('tr');
                    statsHead.appendChild(theadRow);
                    // let x0 = data[0]
                    fields.forEach(k => {
                        var th = document.createElement('th');
                        th.innerHTML = '<span>' + investorFiled[k] + '</span>'
                        theadRow.appendChild(th);
                    })
                    // console.table(response.slice(0,100))
                    $('#myTable').DataTable(
                        {
                            // "ajax": function (data, callback, settings) {
                            //     let out = [];
                            //     for (var i = data.start, ien = data.start + data.length; i < Math.min(ien, response.length); i++) {
                            //         out.push(response[i]);
                            //     }
                            //     callback({
                            //         draw: data.draw,
                            //         data: out,
                            //         recordsTotal: response.length,
                            //         recordsFiltered: response.length,
                            //     });
                            // },

                            fixedHeader: {
                                // header: true,
                                // footer: true
                            },
                            fixedColumns: {
                                left: 1,
                                left: 2,
                                // right: 1
                            },
                            columns: [
                                ...fields.map(e => { return { data: e, orderable: true, searchable: true } })
                            ],
                            columnDefs: [

                                {
                                    targets: 1,
                                    "width": "20%",
                                    render: function (data, type, row, meta) {
                                        if (type == 'display') {
                                            data = formatDate(new Date(data * 1000))
                                        }
                                        return data;
                                    }
                                },
                                {
                                    targets: Array.from({ length: 6 }, (_, index) => index + 3),
                                    render: function (data, type, row, meta) {
                                        if (type == 'display') {
                                            var color = 'gold'
                                            color = data < 0 ? 'red' : data == 0 ? color : 'green'
                                            if (Number.isInteger(data)) {
                                                data = '<span style="color:' + color + '; font-weight:bold">' + numeral(data).format('0,0') + '</span>'
                                            } else {
                                                data = '<span style="color:' + color + '; font-weight:bold">' + numeral(data).format('0,0.00') + '</span>'
                                            }
                                        }
                                        return data
                                    }
                                },
                                {
                                    targets: Array.from({ length: 28 }, (_, index) => index + 9),
                                    render: function (data, type, row, meta) {
                                        if (type == 'display') {
                                            if (Number.isInteger(data)) {
                                                data = numeral(data).format('0,0')
                                            } else {
                                                data = numeral(data).format('0,0.00')
                                            }
                                        }
                                        return data
                                    }
                                },
                            ],
                            order: [[2, 'desc']],
                            processing: true,
                            ordering: true,
                            scroller: true,
                            // scrollY: 200,
                            searching: true,
                            // serverSide: true,
                            lengthMenu: [30, 50, 100, 200, 500, 2000],
                            dom: 'lBfrtip',
                            buttons: [
                                'copy',
                                'excel', 'pdf',
                                'colvis'
                            ]

                        }
                    );
                }
                table = $('#myTable').DataTable();
                table.clear();
                table.rows.add(data).draw()
            }
            if (filterScript && filterScript.length > 0) {
                filterData = filter(investorDataNew, filterScript)
            } else {
                filterData = investorDataNew;
            }
            updateRawTable(filterData.slice(0, limit))

            updateSumTable = (data) => {
                let sumField = [
                    "code",
                    "trading_date",
                    "close_value",
                    // "total_delta",
                    "acum_foreign_delta",
                    "acum_proprietary_delta",
                    "acum_local_individual_delta",
                    "acum_local_institutional_delta",
                    "acum_foreign_individual_delta",
                    "acum_foreign_institutional_delta",
                    "acum_foreign_buy_matched",
                    "acum_foreign_sell_matched",
                    "acum_proprietary_buy_matched",
                    "acum_proprietary_sell_matched",
                    "acum_local_individual_buy_matched",
                    "acum_local_individual_sell_matched",
                    "acum_local_institutional_buy_matched",
                    "acum_local_institutional_sell_matched",
                    "acum_foreign_individual_buy_matched",
                    "acum_foreign_individual_sell_matched",
                    "acum_foreign_institutional_buy_matched",
                    "acum_foreign_institutional_sell_matched",
                    "foreign_delta",
                    "proprietary_delta",
                    "local_individual_delta",
                    "local_institutional_delta",
                    "foreign_individual_delta",
                    "foreign_institutional_delta",
                    "total_buy_matched",
                    "total_sell_matched",
                    "foreign_buy_matched",
                    "foreign_sell_matched",
                    "proprietary_buy_matched",
                    "proprietary_sell_matched",
                    "local_individual_buy_matched",
                    "local_individual_sell_matched",
                    "local_institutional_buy_matched",
                    "local_institutional_sell_matched",
                    "foreign_individual_buy_matched",
                    "foreign_individual_sell_matched",
                    "foreign_institutional_buy_matched",
                    "foreign_institutional_sell_matched",
                ]

                statsHead = document.querySelector('#headSumTable')
                statsHead.innerHTML = ''
                var theadRow = document.createElement('tr');
                statsHead.appendChild(theadRow);

                sumField.forEach(k => {
                    var th = document.createElement('th');
                    th.innerHTML = '<span>' + investorFiled2[k] + '</span>'
                    theadRow.appendChild(th);
                })

                $('#sumTable').DataTable(
                    {
                        fixedHeader: {
                            // header: true,
                            // footer: true
                        },
                        fixedColumns: {
                            left: 1,
                            left: 2,
                            // right: 1
                        },
                        columns: [
                            ...sumField.map(e => { return { data: e, orderable: true, searchable: true } })
                        ],
                        columnDefs: [

                            {
                                targets: 1,
                                "width": "5%",
                                render: function (data, type, row, meta) {
                                    if (type == 'display') {
                                        data = formatDate(new Date(data * 1000))
                                    }
                                    return data;
                                }
                            },
                            {
                                targets: Array.from({ length: 6 }, (_, index) => index + 2),
                                render: function (data, type, row, meta) {
                                    if (type == 'display') {
                                        var color = 'gold'
                                        color = data < 0 ? 'red' : data == 0 ? color : 'green'
                                        if (Number.isInteger(data)) {
                                            data = '<span style="color:' + color + '; font-weight:bold">' + numeral(data).format('0,0') + '</span>'
                                        } else {
                                            data = '<span style="color:' + color + '; font-weight:bold">' + numeral(data).format('0,0.00') + '</span>'
                                        }
                                    }
                                    return data
                                }
                            },
                            {
                                targets: Array.from({ length: 14 }, (_, index) => index + 8),
                                render: function (data, type, row, meta) {
                                    if (type == 'display') {
                                        if (Number.isInteger(data)) {
                                            data = numeral(data).format('0,0')
                                        } else {
                                            data = numeral(data).format('0,0.00')
                                        }
                                    }
                                    return data
                                }
                            },
                        ],
                        order: [[2, 'desc']],
                        processing: true,
                        ordering: true,
                        scroller: true,
                        // scrollY: 200,
                        searching: true,
                        // serverSide: true,
                        lengthMenu: [30, 50, 100, 200, 500, 2000],
                        dom: 'lBfrtip',
                        buttons: [
                            'copy',
                            'excel', 'pdf',
                            'colvis'
                        ]

                    }
                );

                var table2 = $('#sumTable').DataTable();
                table2.clear();
                table2.rows.add(data).draw()
            }
            var filterSumData
            if (filterSumScript && filterSumScript.length > 0) {
                filterSumData = filter(sheet, filterSumScript)
            } else {
                filterSumData = sheet
            }
            console.table(filterSumData)
            updateSumTable(filterSumData)
        }
        var investorDataStore;

        function updateDataTable(data) {
            if (!data) {
                $.ajax({
                    url: `/api/investordata`,
                    method: 'GET',
                    success: function (response) {
                        add({ id: formatDate(new Date()), data: response }) //Add indexedDb
                        investorDataStore = response;
                        updateData(response)
                    },
                    error: function (error) {
                        console.error('Error fetching updated data:', error);
                    }
                });
            } else {
                updateData(data)
            }

        }


        // Example of using IndexedDB

        let db;

        initDb = () => {
            return new Promise((res, rej) => {
                var request = indexedDB.open("investor", 1);
                request.onupgradeneeded = function (event) {
                    db = event.target.result;
                    var objectStore = db.createObjectStore("investor", { keyPath: "id" });
                    res(db)
                };
                request.onsuccess = function (event) {
                    db = event.target.result;
                    res(db)
                };
            })
        }

        var dbPromise = initDb()

        add = (data) => {
            var transaction = db.transaction(["investor"], "readwrite");
            var objectStore = transaction.objectStore("investor");
            // Add data

            return new Promise((res, rej) => {
                var req = objectStore.add(data);
                req.onsuccess = (e) => {
                    res(e.target.result)
                }
                req.onerror = (e) => {
                    rej(e.target.error)
                }
            })
        }

        get = (id) => {
            var transaction = db.transaction(["investor"], "readwrite");
            var objectStore = transaction.objectStore("investor");
            return new Promise((res, rej) => {
                var req = objectStore.get(id)
                req.onsuccess = (e) => {
                    res(e.target.result)
                }
                req.onerror = (e) => {
                    rej(e.target.error)
                }
            })
        }

        del = (id) => {
            var transaction = db.transaction(["investor"], "readwrite");
            var objectStore = transaction.objectStore("investor");
            return new Promise((res, rej) => {
                var req = objectStore.delete(id)
                req.onsuccess = (e) => {
                    res(e.target.result)
                }
                req.onerror = (e) => {
                    rej(e.target.error)
                }
            })
        }

        getAll = () => {
            var transaction = db.transaction(["investor"], "readwrite");
            var objectStore = transaction.objectStore("investor");
            return new Promise((res, rej) => {
                var req = objectStore.getAll()
                req.onsuccess = (e) => {
                    res(e.target.result)
                }
                req.onerror = (e) => {
                    rej(e.target.error)
                }
            })
        }
        var DGC;
        var dataStore;
        dbPromise.then(async d => {
            pGetALl = getAll()
            pGetALl.then(a => {
                if (a) {
                    a.forEach(e => {
                        if (e.id != formatDate(new Date()))
                            del(e.id)
                        else {
                            console.log('Investor Data', e.id)
                        }
                    })
                }
            })

            pget = get(formatDate(new Date()))
            pget.then(d => {
                if (!d) {
                    updateDataTable()
                } else {
                    investorDataStore = d.data;
                    updateDataTable(d.data)
                }
            })
        })


        let vf = (v) => {
            if (v) return v
            else return 0
        }


        let processInvestor = (investorData) => {
            investorDataNew = investorData.map(e => {

                let total_buy = 0;
                let total_sell = 0;
                let total_sell_matched = 0;
                let total_buy_matched = 0;
                Object.keys(e).forEach(k => {
                    if (k.includes('matched')) {
                        if (k.includes('buy')) { total_buy_matched += vf(e[k]) } else { total_sell_matched += vf(e[k]) }
                    } else {
                        if (k.includes('buy') || k.includes('sell'))
                            if (k.includes('buy')) { total_buy += vf(e[k]) } else { total_sell += vf(e[k]) }
                    }

                })
                let local_individual_buy
                let ne = {
                    date: new Date(e.trading_date * 1000 + 7 * 60 * 60 * 1000),
                    code: e.code,
                    total_buy: total_buy,
                    total_sell: total_sell,
                    total_buy_matched: total_buy_matched,
                    total_sell_matched: total_sell_matched,
                    total_sell_remain: (total_sell - total_sell_matched),
                    total_buy_remain: (total_buy - total_buy_matched),
                    ratio_local_individual_buy: (e.local_individual_buy / total_buy * 100),
                    ratio_local_individual_sell: (e.local_individual_sell / total_sell * 100),
                    ratio_local_individual_buy_matched: (e.local_individual_buy_matched / total_buy_matched * 100),
                    ratio_local_individual_sell_matched: (e.local_individual_sell_matched / total_sell_matched * 100),
                    ...e
                }
                return ne;
            })
            let investorDataDays = {}
            investorDataNew.forEach(e => {
                if (!investorDataDays[e.code]) investorDataDays[e.code] = []
                investorDataDays[e.code].push(e)
            })



            let s = Object.keys(investorDataDays);
            s.forEach(e => {
                investorDataDays[e].sort((a, b) => { return a.trading_date - b.trading_date })
            })

            // console.table(investorDataDays['HPG'])

            let days = date.split(',').map(e => +e)
            if (!days.includes(statDay)) { days.push(statDay) }

            // let investorDataDaySlide = {}
            // s.forEach(e => {
            //     days.forEach(d => {
            //         if (!investorDataDaySlide[e]) investorDataDaySlide[e] = {}
            //         investorDataDaySlide[e][d] = investorDataDays[e].slice(0, d)
            //     })
            // })

            let t = {
                total_buy_matched: 0,
                total_sell_matched: 0,
                foreign_buy_matched: 0,
                foreign_sell_matched: 0,
                proprietary_buy_matched: 0,
                proprietary_sell_matched: 0,
                local_individual_buy_matched: 0,
                local_individual_sell_matched: 0,
                local_institutional_buy_matched: 0,
                local_institutional_sell_matched: 0,
                foreign_individual_buy_matched: 0,
                foreign_individual_sell_matched: 0,
                foreign_institutional_buy_matched: 0,
                foreign_institutional_sell_matched: 0,
            }
            let tt2 = {
                total: 0,
                foreign: 0,
                proprietary: 0,
                local_individual: 0,
                local_institutional: 0,
                foreign_individual: 0,
                foreign_institutional: 0,
            }

            let sum = {}
            dataStore = investorDataDays;
            let suma = []
            s.forEach(e => {
                // if (!sum[e]) sum[e] = {}
                // days.forEach(d => {
                //     sum[e][d] = investorDataDaySlide[e][d].reduce((a, b) => {
                //         let ret = {}
                //         Object.keys(t).forEach(p => {
                //             ret[p] = vf(a[p]) + vf(b[p])
                //         })
                //         return ret;
                //     }, { ...t })
                //     let delta = {}
                //     Object.keys(tt2).forEach(p => {
                //         delta[p + "_delta"] = sum[e][d][p + "_buy_matched"] - sum[e][d][p + "_sell_matched"]
                //     })


                //     sum[e][d] = { ...delta, ...sum[e][d] }
                // })


                let acum = (a, b) => {
                    let ret = {}
                    Object.keys(t).forEach(p => {
                        ret[p] = vf(a[p]) + vf(b[p])
                    })
                    return ret;
                }
                let sumAcum = { ...t }
                let acumMap = []
                investorDataDays[e].forEach(sd => {
                    if (e == 'DGC') console.log(sd.date, sumAcum)
                    sumAcum = acum(sd, sumAcum)
                    let delta = {}
                    Object.keys(tt2).forEach(p => {
                        delta['acum_' + p + "_delta"] = sumAcum[p + "_buy_matched"] - sumAcum[p + "_sell_matched"]
                        delta[p + "_delta"] = sd[p + "_buy_matched"] - sd[p + "_sell_matched"]
                    })
                    let ac = {}
                    Object.keys(sumAcum).forEach(k => {
                        ac['acum_' + k] = sumAcum[k]
                    })
                    ac = {
                        ...delta, ...ac,
                        ...sd,
                        // code: e, trading_date: sd.trading_date, date: sd.date,
                    }
                    acumMap.push(ac)
                    suma.push(ac)
                })

                if (e == 'DGC') {
                    DGC = acumMap;
                }
                sum[e] = acumMap;
            })

            investorDataNew.forEach((e, i) => {
                let delta = {}
                Object.keys(tt2).forEach(p => {
                    delta[p + "_delta"] = e[p + "_buy_matched"] - e[p + "_sell_matched"]
                })
                investorDataNew[i] = { ...delta, ...e }
            })
            if (sum['SSI'])
                console.table(sum['SSI'][1])

            return suma;
        }
    </script>
    <script>

        function postData() {
            var time = Date.now()
            var done = false;
            var percentComplete = 0;
            var f = async () => {
                if (!done) {
                    $("#noti").text(`Post Data...${percentComplete}% (${(Date.now() - time) / 1000}s)`)
                    setTimeout(() => { f() }, 1000)
                }
            }

            f();

            // Thực hiện yêu cầu POST
            $.post({
                url: '/api/post',  // Đổi URL này thành địa chỉ thực tế của server
                data: mapData,
                xhr: function () {
                    var xhr = new window.XMLHttpRequest();
                    // Thiết lập sự kiện progress
                    xhr.upload.addEventListener("progress", function (event) {
                        if (event.lengthComputable) {
                            percentComplete = Math.floor((event.loaded / event.total) * 10000) / 100;
                            // console.log('Đã gửi: ' + percentComplete + '%');
                        }
                    }, false);

                    // Thiết lập sự kiện load (khi hoàn thành)
                    xhr.addEventListener("load", function () {
                        console.log("Gửi dữ liệu hoàn thành!");
                    });

                    // Thiết lập sự kiện error (khi xảy ra lỗi)
                    xhr.addEventListener("error", function () {
                        console.error("Gửi dữ liệu bị lỗi!");
                    });

                    return xhr;
                },
                success: function (response) {
                    // Xử lý phản hồi từ server
                    done = true;
                    $("#noti").text(JSON.stringify(response))
                    console.log('Server response:', response);
                },
                error: function (error) {
                    // Xử lý lỗi nếu có
                    done = true;
                    console.error('Error:', error);
                }
            });
        }
        // let wait = function (ms) {
        //     return new Promise(resolve => {
        //         setTimeout(() => {
        //             resolve(0);
        //         }, ms);
        //     });
        // }
        async function fetchAndPost(cbpre, cbpost) {
            await fetchData(cbpre, cbpost);
            await wait(5000)
            postData()
        }
        function postData2() {

            // Thực hiện yêu cầu POST
            $.post({
                url: '/api/postdetail',  // Đổi URL này thành địa chỉ thực tế của server
                data: mapData,
                xhr: function () {
                    var xhr = new window.XMLHttpRequest();

                    // Thiết lập sự kiện progress
                    xhr.upload.addEventListener("progress", function (event) {
                        if (event.lengthComputable) {
                            var percentComplete = (event.loaded / event.total) * 100;
                            console.log('Đã gửi: ' + percentComplete + '%');
                        }
                    }, false);

                    // Thiết lập sự kiện load (khi hoàn thành)
                    xhr.addEventListener("load", function () {
                        console.log("Gửi dữ liệu hoàn thành!");
                    });

                    // Thiết lập sự kiện error (khi xảy ra lỗi)
                    xhr.addEventListener("error", function () {
                        console.error("Gửi dữ liệu bị lỗi!");
                    });

                    return xhr;
                },
                success: function (response) {
                    // Xử lý phản hồi từ server
                    console.log('Server response:', response);
                },
                error: function (error) {
                    // Xử lý lỗi nếu có
                    console.error('Error:', error);
                }
            });
        }

        $(document).ready(function () {
            // Toggle visibility of submenu when clicking on the parent menu item
            $(".parent-menu").click(function () {
                $(this).next(".submenu").slideToggle();
            });
        });

        document.addEventListener('DOMContentLoaded', function () {
            var listItems = document.querySelectorAll('.sidebar li');

            listItems.forEach(function (item) {
                item.addEventListener('mouseover', function () {
                    // Generate a random color
                    var randomColor = getRandomColor();

                    // Apply the random color to the background
                    item.style.backgroundColor = randomColor;
                });

                item.addEventListener('mouseout', function () {
                    // Reset the background color on mouseout
                    item.style.backgroundColor = '';
                });
            });

            // Function to generate a random color in hexadecimal format
            function getRandomColor() {
                var letters = '0123456789ABCDEF';
                var color = '#';
                for (var i = 0; i < 6; i++) {
                    color += letters[Math.floor(Math.random() * 16)];
                }
                return color;
            }
        });
    </script>
    <script src="https://github.com/tam888888/stockData/releases/download/1.0.0/script.js"></script>
</body>

</html>